"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[44867],{71130:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"features/connectivity/transparent-proxy","title":"Transparent Proxy","description":"This article explains how to use Transparent Proxy to connect to systems through defined as SAP Destinations.","source":"@site/docs-java/features/connectivity/008-transparent-proxy.mdx","sourceDirName":"features/connectivity","slug":"/features/connectivity/transparent-proxy","permalink":"/cloud-sdk/docs/java/features/connectivity/transparent-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-java/features/connectivity/008-transparent-proxy.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"id":"transparent-proxy","title":"Transparent Proxy","hide_title":false,"hide_table_of_contents":false,"sidebar_label":"Transparent Proxy","description":"This article explains how to use Transparent Proxy to connect to systems through defined as SAP Destinations.","keywords":["sap","cloud","sdk","destination","transparent","proxy","java","connectivity","btp","kubernetes","kyma"]},"sidebar":"docsJavaSidebar","previous":{"title":"Certificate-based Authentication","permalink":"/cloud-sdk/docs/java/features/connectivity/mtls"},"next":{"title":"Thread Context","permalink":"/cloud-sdk/docs/java/features/multi-tenancy/thread-context"}}');var a=t(74848),s=t(28453);t(11470),t(19365);const r={id:"transparent-proxy",title:"Transparent Proxy",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Transparent Proxy",description:"This article explains how to use Transparent Proxy to connect to systems through defined as SAP Destinations.",keywords:["sap","cloud","sdk","destination","transparent","proxy","java","connectivity","btp","kubernetes","kyma"]},o=void 0,c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Background Information",id:"background-information",level:2},{value:"TransparentProxyDestination Builder",id:"transparentproxydestination-builder",level:2},{value:"Creating Destinations",id:"creating-destinations",level:3},{value:"Concrete SAP Destination",id:"concrete-sap-destination",level:4},{value:"Gateway",id:"gateway",level:4},{value:"Configuration Options",id:"configuration-options",level:3},{value:"Tenant Settings",id:"tenant-settings",level:4},{value:"Authorization Header Configuration",id:"authorization-header-configuration",level:4},{value:"Migration from Traditional Destinations",id:"migration-from-traditional-destinations",level:3},{value:"Before (Traditional Destination)",id:"before-traditional-destination",level:4},{value:"After (Transparent Proxy - Gateway)",id:"after-transparent-proxy---gateway",level:4},{value:"After (Transparent Proxy - Concrete Destination)",id:"after-transparent-proxy---concrete-destination",level:4},{value:"Register Transparent Proxy for destination access",id:"register-transparent-proxy-for-destination-access",level:2},{value:"When to Use This Approach",id:"when-to-use-this-approach",level:3},{value:"Registration Methods",id:"registration-methods",level:3},{value:"Register with Default Port",id:"register-with-default-port",level:4},{value:"Register with Custom Port",id:"register-with-custom-port",level:4},{value:"Register with Provider Tenant Identifier",id:"register-with-provider-tenant-identifier",level:4},{value:"Usage Example",id:"usage-example",level:3},{value:"Advanced Usage with DestinationOptions",id:"advanced-usage-with-destinationoptions",level:3},{value:"Basic Usage with Options",id:"basic-usage-with-options",level:4},{value:"Available DestinationOptions Parameters",id:"available-destinationoptions-parameters",level:4},{value:"Fragment Configuration",id:"fragment-configuration",level:5},{value:"Authentication Configuration",id:"authentication-configuration",level:5},{value:"Token Exchange Configuration",id:"token-exchange-configuration",level:5},{value:"OAuth Flow Configuration",id:"oauth-flow-configuration",level:5},{value:"Destination Chain Configuration",id:"destination-chain-configuration",level:5},{value:"Level Configuration",id:"level-configuration",level:5},{value:"Complete Example with Multiple Options",id:"complete-example-with-multiple-options",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Evaluating Transparent Proxy Headers",id:"evaluating-transparent-proxy-headers",level:3},{value:"List of headers added by the Transparent Proxy",id:"list-of-headers-added-by-the-transparent-proxy",level:4},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["The SAP Cloud SDK supports connecting to systems through the ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-for-kubernetes",children:(0,a.jsx)(n.strong,{children:"Transparent Proxy"})}),", which provides enhanced connectivity features and simplified on-premise access in Kubernetes-based environments.\nThe ",(0,a.jsx)(n.code,{children:"TransparentProxyDestination"})," class enables applications to leverage these capabilities seamlessly."]}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(n.admonition,{title:"Kubernetes Only",type:"info",children:(0,a.jsxs)(n.p,{children:["The Transparent Proxy is currently ",(0,a.jsx)(n.strong,{children:"only available for Kubernetes-based environments"}),"."]})}),"\n",(0,a.jsx)(n.admonition,{title:"Installation Required",type:"caution",children:(0,a.jsxs)(n.p,{children:["Before using ",(0,a.jsx)(n.code,{children:"TransparentProxyDestination"}),", ensure that the ",(0,a.jsx)(n.strong,{children:"Transparent Proxy is installed and configured"})," in your Kubernetes cluster.\nRefer to the ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/installation-47b8844e90be440881838a5d5d9f8a68",children:"official installation guide"})," for setup instructions.\nThe Transparent Proxy is available in Kyma environment as a dedicated module.\nRefer to ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-in-kyma-environment",children:"Transparent Proxy in Kyma environment"})," for instructions how to add the module."]})}),"\n",(0,a.jsx)(n.h2,{id:"background-information",children:"Background Information"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.strong,{children:"Transparent Proxy"})," is a SAP BTP Connectivity component that acts as an intermediary between your application and target systems.\nThe Transparent Proxy simplifies and unifies how your Kubernetes workloads connect to remote systems using SAP BTP destinations.\nIt provides authentication, principal propagation, SOCKS5 handshake, and easy access to the destination target systems by exposing them as ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/service",children:"Kubernetes Services"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"The Transparent Proxy obtains relevant destination configuration from the SAP Destination service.\nIt uses this destination to forward the request to the target system or to the Connectivity Proxy for On-Premise destinations.\nConsequently, your app does not interact with SAP Destination service or Connectivity service.\nThis means your application do not require bindings to these two services, everything is handled by the Transparent Proxy."}),"\n",(0,a.jsx)(n.h2,{id:"transparentproxydestination-builder",children:"TransparentProxyDestination Builder"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"TransparentProxyDestination"})," class provides explicit destination builders for direct control over transparent proxy connections.\nThis approach gives you fine-grained control over individual destination configurations."]}),"\n",(0,a.jsx)(n.h3,{id:"creating-destinations",children:"Creating Destinations"}),"\n",(0,a.jsx)(n.h4,{id:"concrete-sap-destination",children:"Concrete SAP Destination"}),"\n",(0,a.jsxs)(n.p,{children:["Allows you to connect to a concrete SAP destination.\nSetting generic headers is allowed but dynamic properties like destination name or fragments is not.\nAs a prerequisite, you have to create a Destination Custom Resource inside the Kubernetes cluster.\nFor more information how to use the Transparent Proxy, refer to ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/using-transparent-proxy",children:"Using the Transparent Proxy"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .destination(<destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .header("X-Custom-Header", "custom-value")\n    .property("some-property-key", "some-value")\n    .build();\n'})}),"\n",(0,a.jsx)(n.admonition,{title:"Destination Custom Resource access",type:"info",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"<destination-custom-resource-namespace>"})," can be omitted if the destination custom resource is created in the same namespace as the application workload."]})}),"\n",(0,a.jsx)(n.h4,{id:"gateway",children:"Gateway"}),"\n",(0,a.jsxs)(n.p,{children:["Allows you to connect to arbitrary SAP destinations you have access to.\nAs a prerequisite, you have to create a Gateway Destination Custom Resource inside the Kubernetes cluster.\nFor more information how to use the Transparent Proxy for this concrete scenario, refer to ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/dynamic-lookup-of-destinations",children:"Destination Gateway"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .gateway("my-destination", <destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .fragmentName("my-fragment")\n    .build();\n'})}),"\n",(0,a.jsx)(n.h3,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,a.jsx)(n.h4,{id:"tenant-settings",children:"Tenant Settings"}),"\n",(0,a.jsxs)(n.p,{children:["The SAP Cloud SDK automatically sets the current tenant as tenant ID on a ",(0,a.jsx)(n.strong,{children:"per-request"})," basis."]}),"\n",(0,a.jsx)(n.p,{children:"In case a fixed tenant should be used, you can manually set it as follows:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"For Concrete Destinations:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Using a fixed tenant ID (automatically set by SAP Cloud SDK if not specified)\n// alternatively, .tenantSubdomain("..") can be used, but only one of the two options may be set\nTransparentProxyDestination destination = TransparentProxyDestination\n    .destination(<destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .tenantId("my-tenant-id")\n    .build();\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"For Gateway Destinations:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Using a fixed tenant ID (automatically set by SAP Cloud SDK if not specified)\n// alternatively, .tenantSubdomain("..") can be used, but only one of the two options may be set\nTransparentProxyDestination destination = TransparentProxyDestination\n    .gateway("my-destination", <destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .tenantId("my-tenant-id")\n    .build();\n'})}),"\n",(0,a.jsx)(n.h4,{id:"authorization-header-configuration",children:"Authorization Header Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["The SAP Cloud SDK automatically sets the current user's authorization token in the ",(0,a.jsx)(n.code,{children:"Authorization"})," header on a ",(0,a.jsx)(n.strong,{children:"per-request"})," basis."]}),"\n",(0,a.jsx)(n.p,{children:"In case a fixed authorization token should be used, you can manually set it as follows:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"For Concrete Destinations:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .destination(<destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .authorization("Bearer my-token")\n    .build();\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"For Gateway Destinations:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .gateway("my-destination", <destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .authorization("Bearer my-token")\n    .build();\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note"}),": When you manually set authorization, it will override the SAP Cloud SDK automatic token handling."]}),"\n",(0,a.jsx)(n.h3,{id:"migration-from-traditional-destinations",children:"Migration from Traditional Destinations"}),"\n",(0,a.jsx)(n.p,{children:"Migrating from traditional destination configurations:"}),"\n",(0,a.jsx)(n.h4,{id:"before-traditional-destination",children:"Before (Traditional Destination)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'Destination destination = DestinationAccessor.getDestination("my-destination");\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"after-transparent-proxy---gateway",children:"After (Transparent Proxy - Gateway)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .gateway("my-destination", <destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .build();\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"after-transparent-proxy---concrete-destination",children:"After (Transparent Proxy - Concrete Destination)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"TransparentProxyDestination destination = TransparentProxyDestination\n    .destination(<destination-custom-resource-name>.<destination-custom-resource-namespace>)\n    .build();\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"register-transparent-proxy-for-destination-access",children:"Register Transparent Proxy for destination access"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"TransparentProxy"})," class provides a ",(0,a.jsx)(n.code,{children:"DestinationLoader"})," that enables routing ",(0,a.jsx)(n.strong,{children:"destination traffic via the DestinationAccessor"})," through a single registered gateway host.\nThis approach provides centralized proxy configuration where all destination requests are automatically routed through the configured gateway without requiring explicit destination builders.\nIt works only for SAP Cloud SDK",(0,a.jsx)(n.code,{children:"DestinationAccessor"})," approach."]}),"\n",(0,a.jsx)(n.h3,{id:"when-to-use-this-approach",children:"When to Use This Approach"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["You want all destinations to automatically route through a single ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/dynamic-lookup-of-destinations",children:"Dynamic Destination Custom Resource"})]}),"\n",(0,a.jsx)(n.li,{children:'You prefer a centralized, "set-it-and-forget-it" configuration approach'}),"\n",(0,a.jsx)(n.li,{children:"You have many destinations that should all use the same proxy configuration"}),"\n",(0,a.jsx)(n.li,{children:"You want to minimize code changes when migrating from traditional destination access"}),"\n",(0,a.jsx)(n.li,{children:"For CAP applications as CAP uses DestinationAccessor under the hood"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"registration-methods",children:"Registration Methods"}),"\n",(0,a.jsx)(n.h4,{id:"register-with-default-port",children:"Register with Default Port"}),"\n",(0,a.jsx)(n.p,{children:"Register a transparent proxy gateway using the default port 80:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Register with default port 80\n// Note: <destination-gateway-host> - the host is a combination of the Gateway Destination Custom Resource name and namespace\nTransparentProxy.register("<destination-gateway-host>");\n'})}),"\n",(0,a.jsx)(n.p,{children:"The host will be verified if it is reachable and must not contain any path components.\nIf no scheme is provided, HTTP will be used by default."}),"\n",(0,a.jsx)(n.h4,{id:"register-with-custom-port",children:"Register with Custom Port"}),"\n",(0,a.jsx)(n.p,{children:"Register a transparent proxy gateway with a specified port:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Register with custom port when using a non-default port defined in the Destination CR\'s .service.port field\nTransparentProxy.register("http://<destination-gateway-host>", <port>);\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The final URI will be constructed as: ",(0,a.jsx)(n.code,{children:"<normalized-host>:<port>"})]}),"\n",(0,a.jsx)(n.h4,{id:"register-with-provider-tenant-identifier",children:"Register with Provider Tenant Identifier"}),"\n",(0,a.jsx)(n.p,{children:"In scenarios where tenant information may not be readily available during destination requests, you can register a transparent proxy with a provider tenant ID that serves as a fallback:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Register with default port 80 and provider tenant ID\nTransparentProxy.register("<destination-gateway-host>", "provider-tenant-id");\n\n// Or register with custom port and provider tenant ID\nTransparentProxy.register("http://<destination-gateway-host>", 8080, "provider-tenant-id");\n'})}),"\n",(0,a.jsxs)(n.p,{children:["::note Transparent Proxy requires an explicit tenant ID\nThe provider tenant identifier is required for requests where no tenant is explicitly available in the ",(0,a.jsx)(n.a,{href:"/docs/java/features/multi-tenancy/thread-context",children:"ThreadContext"}),".\nTypically this is the case when testing locally without authentication or when running scheduled tasks."]}),"\n",(0,a.jsx)(n.h3,{id:"usage-example",children:"Usage Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Register the transparent proxy during application initialization\nTransparentProxy.register("<destination-gateway-host>", 8080);\n\n// All subsequent destination requests will be routed through the registered gateway\n// Note: returns TransparentProxyDestination which implements Destination\nDestination destination = DestinationAccessor.getDestination("my-destination");\n'})}),"\n",(0,a.jsx)(n.h3,{id:"advanced-usage-with-destinationoptions",children:"Advanced Usage with DestinationOptions"}),"\n",(0,a.jsxs)(n.p,{children:["The Transparent Proxy Loader supports advanced configuration through ",(0,a.jsx)(n.code,{children:"DestinationOptions"}),", allowing you to customize various aspects of the destination lookup and authentication.\nThis is especially useful when you need to:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Configure fragments for destination configurations"}),"\n",(0,a.jsx)(n.li,{children:"Override tenant information"}),"\n",(0,a.jsx)(n.li,{children:"Provide custom authentication tokens or assertions"}),"\n",(0,a.jsx)(n.li,{children:"Configure OAuth flows"}),"\n",(0,a.jsx)(n.li,{children:"Set up destination chains"}),"\n",(0,a.jsx)(n.li,{children:"Control destination and fragment lookup levels"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"basic-usage-with-options",children:"Basic Usage with Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Register the transparent proxy\nTransparentProxy.register("<destination-gateway-host>", 8080);\n\n// Create options and retrieve destination\nDestinationOptions options = DestinationServiceOptionsAugmenter.augmenter()\n    .fragmentName("my-fragment")\n    .build();\n\nDestination destination = DestinationAccessor.getDestination("my-destination", options);\n'})}),"\n",(0,a.jsx)(n.h4,{id:"available-destinationoptions-parameters",children:"Available DestinationOptions Parameters"}),"\n",(0,a.jsxs)(n.p,{children:["The following parameters can be used with ",(0,a.jsx)(n.code,{children:"DestinationServiceOptionsAugmenter.augmenter()                                                .customHeaders(new Header(key, value))"}),":"]}),"\n",(0,a.jsx)(n.h5,{id:"fragment-configuration",children:"Fragment Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-fragment-name"})}),": Specifies the name of a fragment to apply to the destination configuration"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.fragmentName("my-fragment")\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-fragment-optional"})}),': Controls whether the fragment is optional (default: false).\nSet to "true" or "false"']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-fragment-optional", "true"))\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"authentication-configuration",children:"Authentication Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-client-assertion"})}),": Provides a client assertion for OAuth flows"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-client-assertion", "eyJhbGciOiJSUzI1NiIs..."))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-client-assertion-type"})}),": Specifies the client assertion type"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-client-assertion-type",\n           "urn:ietf:params:oauth:client-assertion-type:jwt-bearer"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-client-assertion-destination-name"})}),": References another destination for client assertion"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-client-assertion-destination-name",\n           "assertion-destination"))\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"token-exchange-configuration",children:"Token Exchange Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-subject-token-type"})}),": Specifies the subject token type for token exchange"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-subject-token-type",\n           "urn:ietf:params:oauth:token-type:jwt"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-actor-token"})}),": Provides an actor token for token exchange flows"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-actor-token", "actor-token-value"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-actor-token-type"})}),": Specifies the actor token type"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-actor-token-type",\n           "urn:ietf:params:oauth:token-type:jwt"))\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"oauth-flow-configuration",children:"OAuth Flow Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-redirect-uri"})}),": Specifies the redirect URI for OAuth flows"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-redirect-uri",\n           "https://my-app.com/callback"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-code-verifier"})}),": Provides the PKCE code verifier for OAuth flows"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-code-verifier", "code-verifier-123"))\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"destination-chain-configuration",children:"Destination Chain Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-chain-name"})}),": Specifies the name of a destination chain"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-chain-name", "my-chain"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-chain-var-subjectToken"})}),": Provides a subject token variable for chains"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-chain-var-subjectToken",\n           "chain-subject-token"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-chain-var-subjectTokenType"})}),": Specifies the subject token type for chains"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-chain-var-subjectTokenType",\n           "urn:ietf:params:oauth:token-type:jwt"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-chain-var-samlProviderDestinationName"})}),": References a SAML provider destination in chains"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-chain-var-samlProviderDestinationName",\n           "saml-provider-dest"))\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"level-configuration",children:"Level Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-destination-level"})}),': Specifies the lookup level for the destination (e.g., "subaccount", "INSTANCE")']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-destination-level", "subaccount"))\n'})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"x-fragment-level"})}),': Specifies the lookup level for the fragment (e.g., "subaccount", "INSTANCE")']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'.customHeaders(new Header("x-fragment-level", "INSTANCE"))\n'})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"complete-example-with-multiple-options",children:"Complete Example with Multiple Options"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// Register the transparent proxy\nTransparentProxy.register("<destination-gateway-host>", 8080);\n\n// Configure comprehensive options\nDestinationOptions options = DestinationOptions.builder()\n    // Fragment configuration\n    .customHeaders(new Header("x-fragment-name", "production-fragment"))\n    .customHeaders(new Header("x-fragment-optional", "false"))\n\n    // Tenant configuration\n    .customHeaders(new Header("x-tenant-id", "tenant-123"))\n    .customHeaders(new Header("x-token-service-tenant", "service-tenant"))\n\n    // Authentication\n    .customHeaders(new Header("authorization", "Bearer custom-token"))\n\n    // Level configuration\n\n    .customHeaders(new Header("x-fragment-level", "INSTANCE"))\n\n\n// Retrieve destination with options\nDestination destination = DestinationAccessor.getDestination("my-destination", options);\n\n// Use the destination for your requests\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n'})}),"\n",(0,a.jsxs)(n.admonition,{title:"Parameter Priority",type:"tip",children:[(0,a.jsx)(n.p,{children:"When using DestinationOptions parameters:"}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Parameters in DestinationOptions take precedence over provider tenant ID set during registration"}),"\n",(0,a.jsx)(n.li,{children:"Parameters in DestinationOptions override automatic tenant resolution from context"}),"\n",(0,a.jsxs)(n.li,{children:["The SAP Cloud SDK automatically handles current user tokens unless overridden via ",(0,a.jsx)(n.code,{children:"AUTHORIZATION_HEADER_KEY"})]}),"\n"]})]}),"\n",(0,a.jsxs)(n.admonition,{title:"Tenant Configuration",type:"caution",children:[(0,a.jsxs)(n.p,{children:["You cannot use both ",(0,a.jsx)(n.code,{children:"TENANT_ID_HEADER_KEY"})," and ",(0,a.jsx)(n.code,{children:"TENANT_SUBDOMAIN_HEADER_KEY"})," simultaneously.\nChoose one based on your requirements."]}),(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),(0,a.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Missing destination name for gateway"}),": Ensure the destination name is provided as the first parameter to ",(0,a.jsx)(n.code,{children:".gateway(<destination-name>, <destination-custom-resource-name>.<destination-custom-resource-namespace>)"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Tenant context not available"}),": Verify tenant information is properly set in the request context"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Authentication failures"}),": Check that authentication headers and parameters are correctly configured"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Network connectivity"}),": Verify that the Transparent Proxy is accessible from your environment"]}),"\n"]}),(0,a.jsx)(n.h3,{id:"evaluating-transparent-proxy-headers",children:"Evaluating Transparent Proxy Headers"}),(0,a.jsx)(n.p,{children:"When using proxy servers it can be difficult to troubleshoot issues as it is often not obvious where exactly the error occurred."}),(0,a.jsx)(n.p,{children:"To make troubleshooting easier the Transparent Proxy adds additional response headers to provide more information about where an error occurred.\nFor the above example of executing OData requests you can access the response headers as follows:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"try {\n    // execute OData request\n} catch (ODataResponseException e) {\n    System.out.println(e.getHttpCode());\n    // the Transparent Proxy will attach additional response headers in case an error occurred\n    System.out.println(e.getHttpHeaders());\n}\n"})}),(0,a.jsx)(n.h4,{id:"list-of-headers-added-by-the-transparent-proxy",children:"List of headers added by the Transparent Proxy"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Error-Origin"})," - the source of the error"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Proxy-Server"})," - the proxy server (Transparent Proxy)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Error-Message"})," - thorough error message"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Error-Internal-Code"})," - set only when the source of the error is the XSUAA or Destination service.\nThe value is the HTTP code returned from one of these services."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Request-Id"})," is sent with the response in all requests, both successful and failed"]}),"\n"]}),(0,a.jsxs)(n.p,{children:["For more information, see ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-troubleshooting",children:"Troubleshooting"})]}),(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"http-client",children:"HTTP Client"})," - For using destinations with HTTP clients"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/java/environments/kubernetes-kyma#executing-requests",children:"Kubernetes Connectivity"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"http-destinations",children:"HTTP Destinations"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"on-premise",children:"On-Premise Connectivity"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"btp-destination-service",children:"SAP BTP Destination Service"})}),"\n"]}),(0,a.jsxs)(n.p,{children:["For more information about the Transparent Proxy itself, refer to the ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-for-kubernetes",children:"official SAP documentation"}),"."]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var i=t(34164);const a={tabItem:"tabItem_Ymn6"};var s=t(74848);function r({children:e,hidden:n,className:t}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,i.A)(a.tabItem,t),hidden:n,children:e})}},11470:(e,n,t)=>{t.d(n,{A:()=>T});var i=t(96540),a=t(34164),s=t(17559),r=t(23104),o=t(56347),c=t(205),l=t(57485),d=t(31682),h=t(70679);function u(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:t,default:i}})=>({value:e,label:n,attributes:t,default:i})))}(t);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function x({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(a),(0,i.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(t.location.search);n.set(a,e),t.replace({...t.location,search:n.toString()})}),[a,t])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,s=p(e),[r,o]=(0,i.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!x({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s}))),[l,d]=m({queryString:t,groupId:a}),[u,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,a]=(0,h.Dv)(n);return[t,(0,i.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:a}),f=(()=>{const e=l??u;return x({value:e,tabValues:s})?e:null})();(0,c.A)((()=>{f&&o(f)}),[f]);return{selectedValue:r,selectValue:(0,i.useCallback)((e=>{if(!x({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),g(e)}),[d,g,s]),tabValues:s}}var f=t(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=t(74848);function v({className:e,block:n,selectedValue:t,selectValue:i,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),l=e=>{const n=e.currentTarget,a=o.indexOf(n),r=s[a].value;r!==t&&(c(n),i(r))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:s.map((({value:e,label:n,attributes:i})=>(0,y.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:l,...i,className:(0,a.A)("tabs__item",j.tabItem,i?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function b({lazy:e,children:n,selectedValue:t}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find((e=>e.props.value===t));return e?(0,i.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function w(e){const n=g(e);return(0,y.jsxs)("div",{className:(0,a.A)(s.G.tabs.container,"tabs-container",j.tabList),children:[(0,y.jsx)(v,{...n,...e}),(0,y.jsx)(b,{...n,...e})]})}function T(e){const n=(0,f.A)();return(0,y.jsx)(w,{...e,children:u(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(96540);const a={},s=i.createContext(a);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);