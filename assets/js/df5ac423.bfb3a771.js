"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[44867],{71130:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"features/connectivity/transparent-proxy","title":"Transparent Proxy Destinations","description":"This article explains how to use Transparent Proxy Destinations to connect to systems through the SAP BTP Transparent Proxy.","source":"@site/docs-java/features/connectivity/008-transparent-proxy.mdx","sourceDirName":"features/connectivity","slug":"/features/connectivity/transparent-proxy","permalink":"/cloud-sdk/docs/java/features/connectivity/transparent-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-java/features/connectivity/008-transparent-proxy.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"id":"transparent-proxy","title":"Transparent Proxy Destinations","hide_title":false,"hide_table_of_contents":false,"sidebar_label":"Transparent Proxy","description":"This article explains how to use Transparent Proxy Destinations to connect to systems through the SAP BTP Transparent Proxy.","keywords":["sap","cloud","sdk","destination","transparent","proxy","java","connectivity","btp","kubernetes","kyma"]},"sidebar":"docsJavaSidebar","previous":{"title":"Certificate-based Authentication","permalink":"/cloud-sdk/docs/java/features/connectivity/mtls"},"next":{"title":"Thread Context","permalink":"/cloud-sdk/docs/java/features/multi-tenancy/thread-context"}}');var r=t(74848),i=t(28453);t(11470),t(19365);const s={id:"transparent-proxy",title:"Transparent Proxy Destinations",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Transparent Proxy",description:"This article explains how to use Transparent Proxy Destinations to connect to systems through the SAP BTP Transparent Proxy.",keywords:["sap","cloud","sdk","destination","transparent","proxy","java","connectivity","btp","kubernetes","kyma"]},o=void 0,l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Background Information",id:"background-information",level:2},{value:"Creating Transparent Proxy Destinations",id:"creating-transparent-proxy-destinations",level:2},{value:"1. Static Destinations",id:"1-static-destinations",level:3},{value:"2. Dynamic Destinations",id:"2-dynamic-destinations",level:3},{value:"Tenant Configuration",id:"tenant-configuration",level:2},{value:"Authorization Header Configuration",id:"authorization-header-configuration",level:2},{value:"Migration from Traditional Destinations",id:"migration-from-traditional-destinations",level:2},{value:"Before (Traditional Destination)",id:"before-traditional-destination",level:3},{value:"After (Transparent Proxy - Dynamic)",id:"after-transparent-proxy---dynamic",level:3},{value:"After (Transparent Proxy - Static)",id:"after-transparent-proxy---static",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Evaluating Transparent Proxy Headers",id:"evaluating-transparent-proxy-headers",level:3},{value:"List of headers added by the Transparent Proxy",id:"list-of-headers-added-by-the-transparent-proxy",level:4},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The SAP Cloud SDK supports connecting to systems through the ",(0,r.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-for-kubernetes",children:(0,r.jsx)(n.strong,{children:"Transparent Proxy"})}),", which provides enhanced connectivity features and simplified on-premise access in Kubernetes-based environments like Kyma.\nThe ",(0,r.jsx)(n.code,{children:"TransparentProxyDestination"})," class enables applications to leverage these capabilities seamlessly."]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.admonition,{title:"Kubernetes Only",type:"info",children:(0,r.jsxs)(n.p,{children:["The Transparent Proxy is currently ",(0,r.jsx)(n.strong,{children:"only available for Kubernetes-based environments"})," such as Kyma and Gardener."]})}),"\n",(0,r.jsx)(n.admonition,{title:"Installation Required",type:"caution",children:(0,r.jsxs)(n.p,{children:["Before using ",(0,r.jsx)(n.code,{children:"TransparentProxyDestination"}),", ensure that the ",(0,r.jsx)(n.strong,{children:"Transparent Proxy is installed and configured"})," in your Kubernetes cluster.\nRefer to the ",(0,r.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/installation-47b8844e90be440881838a5d5d9f8a68",children:"official installation guide"})," for setup instructions."]})}),"\n",(0,r.jsx)(n.h2,{id:"background-information",children:"Background Information"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Transparent Proxy"})," is a connectivity component provided by SAP BTP that acts as an intermediary between your application and target systems.\nWhen using the Transparent Proxy your app performs requests against the Transparent Proxy without explicit authentication.\nThis relies on the secure network communication provided by Kyma via Istio.\nThe Transparent Proxy will obtain the relevant destination from the destination service.\nIt will then use this destination to forward the request to the target system or to the Connectivity Proxy for On-Premise destinations.\nConsequently, your app itself does not interact with destination or connectivity service at all.\nThis means your application pods do not require bindings to these two services."]}),"\n",(0,r.jsx)(n.h2,{id:"creating-transparent-proxy-destinations",children:"Creating Transparent Proxy Destinations"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"TransparentProxyDestination"})," class provides two types of builders for different use cases:"]}),"\n",(0,r.jsx)(n.h3,{id:"1-static-destinations",children:"1. Static Destinations"}),"\n",(0,r.jsx)(n.p,{children:"Static destinations connect directly to a specified URL.\nThey allow setting generic headers but do not support dynamic properties like destination name or fragments."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .staticDestination("https://my-service.com")\n    .header("X-Custom-Header", "custom-value")\n    .property("some-property-key", "some-value")\n    .build();\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-dynamic-destinations",children:"2. Dynamic Destinations"}),"\n",(0,r.jsx)(n.p,{children:"Dynamic destinations require both URL and destination name.\nThey support dynamic properties like fragments."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .dynamicDestination("my-destination", "https://proxy-gateway.com")\n    .fragmentName("my-fragment")\n    .build();\n'})}),"\n",(0,r.jsx)(n.h2,{id:"tenant-configuration",children:"Tenant Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The SAP Cloud SDK will automatically set the current tenant as tenant ID on a ",(0,r.jsx)(n.strong,{children:"per-request"})," basis."]}),"\n",(0,r.jsx)(n.p,{children:"In case a fixed tenant should be used, you can manually set it as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// Using a fixed tenant ID (automatically set by SDK if not specified)\n// alternatively, .tenantSubdomain("..") can be used, but only one of the two options may be set\nTransparentProxyDestination destination = TransparentProxyDestination\n    .dynamicDestination("my-destination", "https://proxy-gateway.com")\n    .tenantId("my-tenant-id")\n    .build();\n'})}),"\n",(0,r.jsx)(n.h2,{id:"authorization-header-configuration",children:"Authorization Header Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The SAP Cloud SDK will automatically set the current user's authorization token in the ",(0,r.jsx)(n.code,{children:"Authorization"})," header on a ",(0,r.jsx)(n.strong,{children:"per-request"})," basis."]}),"\n",(0,r.jsx)(n.p,{children:"In case a fixed authorization token should be used, you can manually set it as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// Dynamic destination with authorization method\nTransparentProxyDestination destination = TransparentProxyDestination\n    .dynamicDestination("my-destination", "https://proxy-gateway.com")\n    .authorization("Bearer my-fixed-token")\n    .build();\n\n// Static destination with authorization method\nTransparentProxyDestination destination = TransparentProxyDestination\n    .staticDestination("https://my-service.com")\n    .authorization("Bearer my-fixed-token")\n    .build();\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": When you manually set authorization, it will override the SAP Cloud SDK automatic token handling."]}),"\n",(0,r.jsx)(n.h2,{id:"migration-from-traditional-destinations",children:"Migration from Traditional Destinations"}),"\n",(0,r.jsx)(n.p,{children:"When migrating from traditional destination configurations:"}),"\n",(0,r.jsx)(n.h3,{id:"before-traditional-destination",children:"Before (Traditional Destination)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'Destination destination = DestinationAccessor.getDestination("my-destination");\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"after-transparent-proxy---dynamic",children:"After (Transparent Proxy - Dynamic)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .dynamicDestination("my-destination", "https://proxy-gateway.com")\n    .build();\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"after-transparent-proxy---static",children:"After (Transparent Proxy - Static)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'TransparentProxyDestination destination = TransparentProxyDestination\n    .staticDestination("https://my-service.com")\n    .build();\nHttpClient client = ApacheHttpClient5Accessor.getHttpClient(destination);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Missing destination name for dynamic destinations"}),": Ensure the destination name is provided as the first parameter to ",(0,r.jsx)(n.code,{children:'.dynamicDestination("destination-name", "gateway-url")'})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tenant context not available"}),": Verify tenant information is properly set in the request context"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication failures"}),": Check that authentication headers and parameters are correctly configured"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network connectivity"}),": Verify that the Transparent Proxy is accessible from your environment"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"evaluating-transparent-proxy-headers",children:"Evaluating Transparent Proxy Headers"}),"\n",(0,r.jsx)(n.p,{children:"When using proxy servers it can be difficult to troubleshoot issues as it is often not obvious where exactly the error occurred.\nFor example, with the Transparent Proxy errors might occur on the target system (e.g. OData service), the Destination Service or the Transparent Proxy itself."}),"\n",(0,r.jsx)(n.p,{children:"To make troubleshooting easier the Transparent Proxy adds additional response headers to provide more information about where an error occurred.\nFor the above example of executing OData requests you can access the response headers as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"try {\n    // execute OData request\n} catch (ODataResponseException e) {\n    System.out.println(e.getHttpCode());\n    // the Transparent Proxy will attach additional response headers in case an error occurred\n    System.out.println(e.getHttpHeaders());\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"list-of-headers-added-by-the-transparent-proxy",children:"List of headers added by the Transparent Proxy"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Error-Origin"})," - the source of the error"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Proxy-Server"})," - the proxy server (Transparent Proxy)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Error-Message"})," - thorough error message"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Error-Internal-Code"})," - set only when the source of the error is the XSUAA or Destination service. The value is the HTTP code returned from one of these services."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X-Request-Id"})," is sent with the response in all requests, both successful and failed"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"http-client",children:"HTTP Client"})," - For using destinations with HTTP clients"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/java/environments/kubernetes-kyma#executing-requests",children:"Kubernetes Connectivity"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"http-destinations",children:"HTTP Destinations"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"on-premise",children:"On-Premise Connectivity"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"btp-destination-service",children:"SAP BTP Destination Service"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For more information about the Transparent Proxy itself, refer to the ",(0,r.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-for-kubernetes",children:"official SAP documentation"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var a=t(34164);const r={tabItem:"tabItem_Ymn6"};var i=t(74848);function s({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,t),hidden:n,children:e})}},11470:(e,n,t)=>{t.d(n,{A:()=>P});var a=t(96540),r=t(34164),i=t(17559),s=t(23104),o=t(56347),l=t(205),c=t(57485),d=t(31682),u=t(70679);function h(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a})))}(t);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function y({value:e,tabValues:n}){return n.some((n=>n.value===e))}function x({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(r),(0,a.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})}),[r,t])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,i=p(e),[s,o]=(0,a.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!y({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i}))),[c,d]=x({queryString:t,groupId:r}),[h,m]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,r]=(0,u.Dv)(n);return[t,(0,a.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:r}),f=(()=>{const e=c??h;return y({value:e,tabValues:i})?e:null})();(0,l.A)((()=>{f&&o(f)}),[f]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!y({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),m(e)}),[d,m,i]),tabValues:i}}var f=t(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function g({className:e,block:n,selectedValue:t,selectValue:a,tabValues:i}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const n=e.currentTarget,r=o.indexOf(n),s=i[r].value;s!==t&&(l(n),a(s))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:i.map((({value:e,label:n,attributes:a})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...a,className:(0,r.A)("tabs__item",v.tabItem,a?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function j({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find((e=>e.props.value===t));return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function T(e){const n=m(e);return(0,b.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",v.tabList),children:[(0,b.jsx)(g,{...n,...e}),(0,b.jsx)(j,{...n,...e})]})}function P(e){const n=(0,f.A)();return(0,b.jsx)(T,{...e,children:h(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(96540);const r={},i=a.createContext(r);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);