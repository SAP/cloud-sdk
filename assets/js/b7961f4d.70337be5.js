"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[20054,25537,52514,57859,59888,75789,94546],{59116:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"environments/code/Dockerfile","title":"Dockerfile","description":"","source":"@site/docs-js/environments/code/Dockerfile.mdx","sourceDirName":"environments/code","slug":"/environments/code/Dockerfile","permalink":"/cloud-sdk/docs/js/environments/code/Dockerfile","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/code/Dockerfile.mdx","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),r=t(28453);const i={},o=void 0,c={},l=[];function d(e){const n={code:"code",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Dockerfile",metastring:'title="Dockerfile"',children:'FROM node:14-alpine\n\nWORKDIR /workdir\n\nCOPY /deployment /workdir\n\nRUN ["npm", "install", "--unsafe-perm"]\n\nEXPOSE 3000\nCMD ["npm", "run", "start:prod"]\n'})})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},89625:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"environments/code/kubernetes-on-premise","title":"kubernetes-on-premise","description":"Prerequisites","source":"@site/docs-js/environments/code/kubernetes-on-premise.mdx","sourceDirName":"environments/code","slug":"/environments/code/kubernetes-on-premise","permalink":"/cloud-sdk/docs/js/environments/code/kubernetes-on-premise","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/code/kubernetes-on-premise.mdx","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),r=t(28453),i=t(65537),o=t(79329);const c={},l=void 0,d={},u=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"Background Information",id:"background-information",level:3},{value:"Create a Kubernetes Resource",id:"create-a-kubernetes-resource",level:3},{value:"Executing Requests",id:"executing-requests",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.p,{children:["This guide assumes you have both the ",(0,a.jsx)(n.strong,{children:"Transparent Proxy"})," (version ",(0,a.jsx)(n.code,{children:">= 1.4.0"}),") and ",(0,a.jsx)(n.strong,{children:"Connectivity Proxy"})," (version ",(0,a.jsx)(n.code,{children:">= 2.11.0"}),") installed in your cluster.\nFor Kyma the Transparent Proxy is available as a module that can be enabled as described ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/transparent-proxy-in-kyma-environment",children:"here"}),".\nThe Connectivity Proxy can be installed as described ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/connectivity/sap-btp-connectivity-cf/operations-via-helm",children:"here"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"background-information",children:"Background Information"}),"\n",(0,a.jsx)(n.p,{children:"When using the Transparent Proxy your app performs requests against the Transparent Proxy without explicit authentication, relying on the secure network communication provided by Kyma via Istio.\nThe Transparent Proxy will obtain the relevant destination from the destination service and use it to forward the request via the Connectivity Proxy to the On-Premise system.\nConsequently, your app itself does not interact with destination or connectivity service at all and thus your application pods do not require bindings to these two services."}),"\n",(0,a.jsx)(n.p,{children:"Please note that the current implementation of the Transparent Proxy does not yet cover all use cases."}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"Constraints when using the Transparent Proxy"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Private Link not yet supported"}),"\n"]})]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["This approach is conceptually different from what you may be used to from a Cloud Foundry environment.\nThe official ",(0,a.jsx)(n.a,{href:"https://help.sap.com/docs/CP_CONNECTIVITY/cca91383641e40ffbe03bdc78f00f681/e661713ef7d14373b57e3e26b0b03b86.html",children:"documentation of the Transparent Proxy"})," gives more information on the architecture."]})}),"\n",(0,a.jsx)(n.h3,{id:"create-a-kubernetes-resource",children:"Create a Kubernetes Resource"}),"\n",(0,a.jsxs)(n.p,{children:["For the creation of the necessary Kubernetes Resources, please refer to our ",(0,a.jsx)(n.a,{href:"/docs/java/environments/kubernetes-kyma#create-a-kubernetes-resource",children:"Java documentation"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"executing-requests",children:"Executing Requests"}),"\n",(0,a.jsx)(n.p,{children:"In your application you can now configure a destination to execute requests:"}),"\n",(0,a.jsxs)(i.A,{groupId:"dynamic-dest",defaultValue:"single",values:[{label:"Individual Destination",value:"single"},{label:"Dynamic Desitnations",value:"dynamic"}],children:[(0,a.jsx)(o.A,{value:"single",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import {\n  registerDestination,\n  getTenantId,\n  retrieveJwt\n} from '@sap-cloud-sdk/connectivity';\n\nconst destination = {\n  name: 'registered-destination',\n  url: 'http://my-destination.namespace/'\n  // for principal propagation make sure to set the forwardAuthToken flag to true:\n  // forwardAuthToken: true\n};\nawait registerDestination(destination, options);\n\nconst result = await myEntityApi\n  .requestBuilder()\n  .getAll()\n  // for a subscriber tenant make sure to send the tenant header:\n  // .addCustomHeaders({ 'X-Tenant-Id': getTenantId(retrieveJwt(request)) })\n  .execute({ destinationName: 'registered-destination' });\n// for principal propagation make sure the send the auth token:\n// .execute({ destinationName: 'registered-destination', jwt: retrieveJwt(request) });\n"})})}),(0,a.jsx)(o.A,{value:"dynamic",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import {\n  registerDestination,\n  getTenantId,\n  retrieveJwt\n} from '@sap-cloud-sdk/connectivity';\n\nconst destination = {\n  name: 'registered-destination',\n  url: 'http://dynamic-destination.namespace/'\n  // for principal propagation make sure to set the forwardAuthToken flag to true:\n  // forwardAuthToken: true\n};\nawait registerDestination(destination, options);\n\nconst result = await myEntityApi\n  .requestBuilder()\n  .getAll()\n  .addCustomHeaders({ 'X-Destination-Name': '<CF-DESTINATION-NAME>' })\n  // for a subscriber tenant make sure to send the tenant header:\n  // .addCustomHeaders({ 'X-Tenant-Id': getTenantId(retrieveJwt(request)) })\n  .execute({ destinationName: 'registered-destination' });\n// for principal propagation make sure the send the auth token:\n// .execute({ destinationName: 'registered-destination', jwt: retrieveJwt(request) });\n"})})})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Replace ",(0,a.jsx)(n.code,{children:"namespace"})," in the URL with the namespace you installed the Transparent Proxy into."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The code above shows an example how you can then use the ",(0,a.jsx)(n.code,{children:"destination"})," object to perform an OData request against the system."]}),"\n",(0,a.jsx)(n.admonition,{title:"Connecting to Cloud systems",type:"tip",children:(0,a.jsxs)(n.p,{children:["The above approach is not limited to destinations of proxy type ",(0,a.jsx)(n.code,{children:"ON_PREMISE"}),", ",(0,a.jsx)(n.code,{children:"INTERNET"})," destinations are supported as well."]})}),"\n",(0,a.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.p,{children:"When using proxy servers it can be difficult to troubleshoot issues as it is often not obvious where exactly the error occurred.\nFor example, with the Transparent Proxy errors might occur on the target system (e.g. OData service), the Destination Service or the Transparent Proxy itself."}),"\n",(0,a.jsx)(n.p,{children:"To make troubleshooting easier the Transparent Proxy adds additional response headers to provide more information about where an error occurred.\nFor the above example of executing OData requests you can access the response headers as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"const result = await myEntityApi\n  .requestBuilder()\n  .getAll()\n  .execute('registered-destination')\n  .catch(err => {\n    console.error('Error Headers:', err.rootCause?.response?.headers);\n  });\n"})}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"List of headers added by the Transparent Proxy"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Error-Origin"})," - the source of the error"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Proxy-Server"})," - the proxy server (Transparent Proxy)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Error-Message"})," - thorough error message"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Error-Internal-Code"})," - set only when the source of the error is the XSUAA or Destination service.\nThe value is the HTTP code returned from one of these services."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"X-Request-Id"})," is sent with the response in all requests, both successful and failed"]}),"\n"]})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},74434:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"environments/code/kyma-app-tabs","title":"kyma-app-tabs","description":"<Tabs defaultValue=\\"deployment\\"","source":"@site/docs-js/environments/code/kyma-app-tabs.mdx","sourceDirName":"environments/code","slug":"/environments/code/kyma-app-tabs","permalink":"/cloud-sdk/docs/js/environments/code/kyma-app-tabs","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/code/kyma-app-tabs.mdx","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),r=t(28453),i=t(65537),o=t(79329);const c={},l=void 0,d={},u=[];function p(e){const n={code:"code",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(i.A,{defaultValue:"deployment",values:[{label:"values.yaml",value:"values"},{label:"Chart.yaml",value:"Chart"},{label:"configmap.yaml",value:"configmap"},{label:"deployment.yaml",value:"deployment"},{label:"service.yaml",value:"service"}],children:[(0,a.jsx)(o.A,{value:"values",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"image:\n  repository: <YOUR_REPO>/k8s-e2e-app:latest # replace <YOUR_REPO> with your Docker repository\n  tag: latest\nresources:\n  requests:\n    memory: '256Mi'\n    cpu: '500m'\n  limits:\n    memory: '512Mi'\n    cpu: '1000m'\n"})})}),(0,a.jsx)(o.A,{value:"Chart",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v2\nname: app-chart\ndescription: A Helm chart for Kubernetes\n\n# A chart can be either an 'application' or a 'library' chart.\n#\n# Application charts are a collection of templates that can be packaged into versioned archives\n# to be deployed.\n#\n# Library charts provide useful utilities or functions for the chart developer. They're included as\n# a dependency of application charts to inject those utilities and functions into the rendering\n# pipeline. Library charts do not define any templates and therefore cannot be deployed.\ntype: application\n\n# This is the chart version. This version number should be incremented each time you make changes\n# to the chart and its templates, including the app version.\n# Versions are expected to follow Semantic Versioning (https://semver.org/)\nversion: 0.1.0\n\n# This is the version number of the application being deployed. This version number should be\n# incremented each time you make changes to the application. Versions are not expected to\n# follow Semantic Versioning. They should reflect the version the application is using.\n# It is recommended to use it with quotes.\nappVersion: '1.0.0'\n"})})}),(0,a.jsx)(o.A,{value:"configmap",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: {{ include "app-chart.fullname" . }}-config\ndata:\n  cloud_destination: {{ .Values.cloudDestination | quote }}\n  onpremise_destination: {{ .Values.onPremiseDestination | quote }}\n  principal_propagation_destination: {{ .Values.principalPropagationDestination | quote }}\n'})})}),(0,a.jsx)(o.A,{value:"service",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: {{ include "app-chart.fullname" . }}-svc\n  labels:\n    {{- include "app-chart.labels" . | nindent 4 }}\nspec:\n  ports:\n    - port: 8080\n      targetPort: 3000\n  selector:\n    {{- include "app-chart.selectorLabels" . | nindent 4 }}\n'})})}),(0,a.jsx)(o.A,{value:"deployment",className:"code-block-height-js thin-scrollbar",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{ include "app-chart.fullname" . }}\n  labels:\n    {{- include "app-chart.labels" . | nindent 4 }}\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      {{- include "app-chart.selectorLabels" . | nindent 6 }}\n  template:\n    metadata:\n      labels:\n        {{- include "app-chart.selectorLabels" . | nindent 8 }}\n    spec:\n      {{- with .Values.imagePullSecrets }}\n      imagePullSecrets:\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n      serviceAccountName: {{ include "app-chart.serviceAccountName" . }}\n      containers:\n        - name: {{ .Chart.Name }}\n          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"\n          ports:\n            - containerPort: 3000\n          resources:\n            {{- toYaml .Values.resources | nindent 12 }}\n          env:\n            - name: CLOUD_DESTINATION\n              valueFrom:\n                configMapKeyRef:\n                  name: {{ include "app-chart.fullname" . }}-config\n                  key: cloud_destination\n            - name: ONPREMISE_DESTINATION\n              valueFrom:\n                configMapKeyRef:\n                  name: {{ include "app-chart.fullname" . }}-config\n                  key: onpremise_destination\n            - name: PRINCIPAL_PROPAGATION_DESTINATION\n              valueFrom:\n                configMapKeyRef:\n                  name: {{ include "app-chart.fullname" . }}-config\n                  key: principal_propagation_destination\n          volumeMounts:\n            - name: destination-volume\n              mountPath: {{ printf "/etc/secrets/sapcp/destination/%s" .Values.destinationBinding | quote }}\n              readOnly: true\n            - name: xsuaa-volume\n              mountPath: {{ printf "/etc/secrets/sapcp/xsuaa/%s" .Values.xsuaaBinding | quote }}\n              readOnly: true\n            - name: connectivity-volume\n              mountPath: {{ printf "/etc/secrets/sapcp/connectivity/%s" .Values.connectivityBinding | quote }}\n              readOnly: true\n      volumes:\n        - name: destination-volume\n          secret:\n            secretName: {{ .Values.destinationBinding | quote }}\n        - name: xsuaa-volume\n          secret:\n            secretName: {{ .Values.xsuaaBinding | quote }}\n        - name: connectivity-volume\n          secret:\n            secretName: {{ .Values.connectivityBinding | quote }}\n'})})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},21026:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"environments/code/kyma-approuter-tabs","title":"kyma-approuter-tabs","description":"<Tabs defaultValue=\\"deployment\\"","source":"@site/docs-js/environments/code/kyma-approuter-tabs.mdx","sourceDirName":"environments/code","slug":"/environments/code/kyma-approuter-tabs","permalink":"/cloud-sdk/docs/js/environments/code/kyma-approuter-tabs","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/code/kyma-approuter-tabs.mdx","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),r=t(28453),i=t(65537),o=t(79329);const c={},l=void 0,d={},u=[];function p(e){const n={code:"code",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(i.A,{defaultValue:"deployment",values:[{label:"values.yaml",value:"values"},{label:"Chart.yaml",value:"Chart"},{label:"configmap.yaml",value:"configmap"},{label:"deployment.yaml",value:"deployment"},{label:"service.yaml",value:"service"}],children:[(0,a.jsx)(o.A,{value:"values",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"xsuaaBinding:\n  config:\n    idp:\n    pattern:\n  image:\n    repository: <YOUR_REPO>/k8s-approuter:latest # replace <YOUR_REPO> with your Docker repository\n    tag: latest\n  resources:\n    requests:\n      memory: '256Mi'\n      cpu: '500m'\n    limits:\n      memory: '512Mi'\n      cpu: '1000m'\n"})})}),(0,a.jsx)(o.A,{value:"Chart",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v2\nname: approuter-chart\ndescription: A Helm chart for Kubernetes\n\n# A chart can be either an 'application' or a 'library' chart.\n#\n# Application charts are a collection of templates that can be packaged into versioned archives\n# to be deployed.\n#\n# Library charts provide useful utilities or functions for the chart developer. They're included as\n# a dependency of application charts to inject those utilities and functions into the rendering\n# pipeline. Library charts do not define any templates and therefore cannot be deployed.\ntype: application\n\n# This is the chart version. This version number should be incremented each time you make changes\n# to the chart and its templates, including the app version.\n# Versions are expected to follow Semantic Versioning (https://semver.org/)\nversion: 0.1.0\n\n# This is the version number of the application being deployed. This version number should be\n# incremented each time you make changes to the application. Versions are not expected to\n# follow Semantic Versioning. They should reflect the version the application is using.\n# It is recommended to use it with quotes.\nappVersion: '1.0.0'\n"})})}),(0,a.jsx)(o.A,{value:"configmap",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: {{ include "approuter-chart.fullname" . }}-config\ndata:\n  {{- if .Values.config.idp }}\n  xs-app.json: {{ printf "{\\"welcomeFile\\":\\"/web-pages/index.html\\",\\"routes\\":[{\\"source\\":\\"/backend-app/(.*)\\",\\"target\\":\\"$1\\",\\"destination\\":\\"backend\\",\\"identityProvider\\":\\"%s\\"},{\\"source\\":\\"/web-pages/(.*)\\",\\"target\\":\\"$1\\",\\"localDir\\":\\"static-resources\\",\\"identityProvider\\":\\"%s\\"}]}" .Values.config.idp .Values.config.idp | toPrettyJson }}\n  {{- else }}\n  xs-app.json: {{ .Values.config.json | toPrettyJson | quote }}\n  {{ end -}}\n'})})}),(0,a.jsx)(o.A,{value:"service",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: {{ include "approuter-chart.fullname" . }}-svc\n  labels:\n    {{- include "approuter-chart.labels" . | nindent 4 }}\nspec:\n  ports:\n    - port: 8080\n      targetPort: 5000\n  selector:\n    {{- include "approuter-chart.selectorLabels" . | nindent 4 }}\n'})})}),(0,a.jsx)(o.A,{value:"deployment",className:"code-block-height-js thin-scrollbar",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{ include "approuter-chart.fullname" . }}\n  labels:\n    {{- include "approuter-chart.labels" . | nindent 4 }}\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      {{- include "approuter-chart.selectorLabels" . | nindent 6 }}\n  template:\n    metadata:\n      labels:\n        {{- include "approuter-chart.selectorLabels" . | nindent 8 }}\n    spec:\n      {{- with .Values.imagePullSecrets }}\n      imagePullSecrets:\n        {{- toYaml . | nindent 8 }}\n      {{- end }}\n      serviceAccountName: {{ include "approuter-chart.serviceAccountName" . }}\n      containers:\n        - name: {{ .Chart.Name }}\n          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"\n          ports:\n            - containerPort: 5000\n          resources:\n            {{- toYaml .Values.resources | nindent 12 }}\n          env:\n            - name: PORT\n              value: "5000"\n            - name: destinations\n              value: \'[{"name":"backend", "url":"http://{{ printf "%s-%s" .Release.Name "app-chart" | trunc 63 | trimSuffix "-" }}-svc:8080/", "forwardAuthToken": true}]\'\n            - name: TENANT_HOST_PATTERN\n              value: {{ .Values.config.pattern | quote }}\n          volumeMounts:\n            - name: xsuaa-volume\n              mountPath: {{ printf "/etc/secrets/sapcp/xsuaa/%s" .Values.xsuaaBinding | quote}}\n              readOnly: true\n            - name: approuter-volume\n              mountPath: "/usr/src/app/xs-app.json"\n              subPath: "xs-app.json"\n              readOnly: true\n      volumes:\n        - name: xsuaa-volume\n          secret:\n            secretName: {{ .Values.xsuaaBinding | quote}}\n        - name: approuter-volume\n          configMap:\n            name: {{ include "approuter-chart.fullname" . }}-config\n            items:\n              - key: xs-app.json\n                path: xs-app.json\n\n\n'})})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},59239:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"environments/code/operator-destination-service","title":"operator-destination-service","description":"","source":"@site/docs-js/environments/code/operator-destination-service.mdx","sourceDirName":"environments/code","slug":"/environments/code/operator-destination-service","permalink":"/cloud-sdk/docs/js/environments/code/operator-destination-service","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/code/operator-destination-service.mdx","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),r=t(28453);const i={},o=void 0,c={},l=[];function d(e){const n={code:"code",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="operator-destination-service.yml"',children:"apiVersion: services.cloud.sap.com/v1alpha1\nkind: ServiceInstance\nmetadata:\n  name: operator-destination-service\nspec:\n  serviceOfferingName: destination\n  servicePlanName: lite\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="operator-destination-binding.yml"',children:"apiVersion: services.cloud.sap.com/v1alpha1\nkind: ServiceBinding\nmetadata:\n  name: operator-destination-service\nspec:\n  serviceInstanceName: operator-destination-service\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},81940:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"environments/code/operator-xsuaa-service","title":"operator-xsuaa-service","description":"","source":"@site/docs-js/environments/code/operator-xsuaa-service.mdx","sourceDirName":"environments/code","slug":"/environments/code/operator-xsuaa-service","permalink":"/cloud-sdk/docs/js/environments/code/operator-xsuaa-service","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/code/operator-xsuaa-service.mdx","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),r=t(28453);const i={},o=void 0,c={},l=[];function d(e){const n={code:"code",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="operator-xsuaa-service.yml"',children:"apiVersion: services.cloud.sap.com/v1alpha1\nkind: ServiceInstance\nmetadata:\n  name: operator-xsuaa-service\nspec:\n  serviceOfferingName: xsuaa\n  servicePlanName: application\n  parameters:\n    xsappname: kubernetes-xsuaa\n    tenant-mode: shared\n    scopes:\n      - name: '$XSAPPNAME.Callback'\n        description: 'With this scope set, the callbacks for tenant onboarding, offboarding and getDependencies can be called.'\n        grant-as-authority-to-apps:\n          - $XSAPPNAME(application,sap-provisioning,tenant-onboarding)\n    role-templates:\n      - name: TOKEN_EXCHANGE\n        description: Token exchange\n        scope-references:\n          - uaa.user\n      - name: 'MultitenancyCallbackRoleTemplate'\n        description: 'Call callback-services of applications'\n        scope-references:\n          - '$XSAPPNAME.Callback'\n    oauth2-configuration:\n      grant-types:\n        - authorization_code\n        - client_credentials\n        - password\n        - refresh_token\n        - urn:ietf:params:oauth:grant-type:saml2-bearer\n        - user_token\n        - client_x509\n        - urn:ietf:params:oauth:grant-type:jwt-bearer\n      # Allowed redirect URIs in case you want to use an approuter behind an ingress for user login\n      redirect-uris:\n        - https://*/**\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="operator-xsuaa-binding.yml"',children:"apiVersion: services.cloud.sap.com/v1alpha1\nkind: ServiceBinding\nmetadata:\n  name: operator-xsuaa-service\nspec:\n  serviceInstanceName: operator-xsuaa-service\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},68193:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"environments/kubernetes","title":"Migrate your App from SAP BTP CF to Kubernetes with the SAP Cloud SDK for JavaScript","description":"Learn how to migrate your application from SAP BTP Cloud Foundry to Kubernetes with the SAP Cloud SDK for JavaScript","source":"@site/docs-js/environments/migrate-sdk-application-from-btp-cf-to-kubernetes.mdx","sourceDirName":"environments","slug":"/environments/kubernetes","permalink":"/cloud-sdk/docs/js/environments/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js/environments/migrate-sdk-application-from-btp-cf-to-kubernetes.mdx","tags":[],"version":"current","frontMatter":{"id":"kubernetes","title":"Migrate your App from SAP BTP CF to Kubernetes with the SAP Cloud SDK for JavaScript","sidebar_label":"Kubernetes with SAP Gardener","description":"Learn how to migrate your application from SAP BTP Cloud Foundry to Kubernetes with the SAP Cloud SDK for JavaScript","keywords":["sap","cloud","sdk","cloud native","cloud sdk","sap cloud sdk","kubernetes"]},"sidebar":"docsJsSidebar","previous":{"title":"Shared ESLint configuration","permalink":"/cloud-sdk/docs/js/features/eslint-configuration"},"next":{"title":"Kubernetes with SAP Kyma","permalink":"/cloud-sdk/docs/js/environments/kyma"}}');var a=t(74848),r=t(28453),i=t(12810);const o={id:"kubernetes",title:"Migrate your App from SAP BTP CF to Kubernetes with the SAP Cloud SDK for JavaScript",sidebar_label:"Kubernetes with SAP Gardener",description:"Learn how to migrate your application from SAP BTP Cloud Foundry to Kubernetes with the SAP Cloud SDK for JavaScript",keywords:["sap","cloud","sdk","cloud native","cloud sdk","sap cloud sdk","kubernetes"]},c="Migrate a Cloud Foundry Application to a Kubernetes Cluster",l={},d=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"Create and Bind SAP BTP Services",id:"create-and-bind-sap-btp-services",level:3},{value:"Bind the Destination Service",id:"bind-the-destination-service",level:4},{value:"Bind the XSUAA Service",id:"bind-the-xsuaa-service",level:4},{value:"Deploy to Kubernetes",id:"deploy-to-kubernetes",level:2},{value:"Containerize the Application",id:"containerize-the-application",level:3},{value:"Create a Deployment Configuration",id:"create-a-deployment-configuration",level:3},{value:"Access Your Application",id:"access-your-application",level:3},{value:"Local Connection",id:"local-connection",level:4},{value:"Internet Facing Connection",id:"internet-facing-connection",level:4},{value:"Configure TLS and Obtain a Domain in SAP Gardener",id:"configure-tls-and-obtain-a-domain-in-sap-gardener",level:3},{value:"Expose the Application using approuter",id:"expose-the-application-using-approuter",level:3},{value:"On-Premise Connectivity",id:"on-premise-connectivity",level:3}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"migrate-a-cloud-foundry-application-to-a-kubernetes-cluster",children:"Migrate a Cloud Foundry Application to a Kubernetes Cluster"})}),"\n",(0,a.jsxs)(n.p,{children:["This guide details the steps necessary to migrate an application from Cloud Foundry to a Gardener-based Kubernetes cluster.\nThe samples repository contains the ",(0,a.jsx)(n.a,{href:"https://github.com/SAP-samples/cloud-sdk-js/tree/main/samples/k8s-sample-application",children:"Kubernetes application"})," that will be used in this guide."]}),"\n",(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Install ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:(0,a.jsx)(n.code,{children:"kubectl"})}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Install ",(0,a.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:(0,a.jsx)(n.code,{children:"docker"})})," and ensure access to a publicly reachable Docker repository."]}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsxs)(n.p,{children:["A Kubernetes cluster uses a secret to authenticate with a container registry to pull an image.\nFor that, you will need to ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-secret-by-providing-credentials-on-the-command-line",children:"configure a secret in your cluster"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl create secret docker-registry regcred --docker-server=YOUR_DOCKER_SERVER --docker-username=YOUR_DOCKER_USERNAME --docker-password=YOUR_DOCKER_PASSWORD --docker-email=YOUR_DOCKER_EMAIL\n"})})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.a,{href:"https://dashboard.garden.canary.k8s.ondemand.com/",children:"Gardener"})," for a Kubernetes Cluster with a load balancer enabled."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["This guide assumes you have created a cluster via Gardener dashboard and have it set up for cluster access.\nWe also recommend to have an ",(0,a.jsx)(n.strong,{children:"Ingress"})," set up that exposes the application to the internet."]})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Install ",(0,a.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:(0,a.jsx)(n.code,{children:"helm"})}),", a package manager for Kubernetes."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Install the ",(0,a.jsx)(n.a,{href:"https://github.com/SAP/sap-btp-service-operator/",children:"SAP BTP Service Operator"})," in the cluster."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["For production environments, you need a reliable way of configuring which services are running in your cluster.\nTo achieve that, leverage the SAP BTP Service Operator.\nThis guide assumes you have the SAP BTP Service Operator installed in your cluster.\nIf not, follow the setup instructions ",(0,a.jsx)(n.a,{href:"https://github.com/SAP/sap-btp-service-operator#setup",children:"here"}),"."]})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"create-and-bind-sap-btp-services",children:"Create and Bind SAP BTP Services"}),"\n",(0,a.jsx)(n.p,{children:"Since the service operator is running in your cluster, you can create services just like you would do in SAP BTP CF, but instead of the SAP BTP cockpit, you'll use YAML service definitions.\nFor this guide, we'll assume the application uses two services:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Destination Service"}),"\n",(0,a.jsx)(n.li,{children:"XSUAA Service"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"bind-the-destination-service",children:"Bind the Destination Service"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Create ",(0,a.jsx)(n.code,{children:"yaml"})," files for the destination service instance and binding:"]}),"\n"]}),"\n",(0,a.jsx)(i.WL,{}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Install the configuration using the commands:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f operator-destination-service.yml\nkubectl apply -f operator-destination-binding.yml\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This should create a Kubernetes secret named ",(0,a.jsx)(n.code,{children:"operator-destination-service"}),".\nThis secret will contain the actual service binding information."]}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["Monitor the status via ",(0,a.jsx)(n.code,{children:"kubectl describe ServiceInstance operator-destination-service"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"bind-the-xsuaa-service",children:"Bind the XSUAA Service"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"yaml"})," files for the XSUAA service instance and binding:"]}),"\n",(0,a.jsx)(i.aQ,{}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["Repeat steps 2 and 3 from the ",(0,a.jsx)(n.a,{href:"#bind-the-destination-service",children:"previous section"})," for the XSUAA service.\nReplace ",(0,a.jsx)(n.code,{children:"destination"})," with ",(0,a.jsx)(n.code,{children:"xsuaa"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["We will see how to mount the created secrets into the file system of the application in the ",(0,a.jsx)(n.a,{href:"#create-a-deployment-configuration",children:"deployment configuration"})," step."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Notice that the ",(0,a.jsx)(n.code,{children:"metadata -> name"})," property can be anything you want.\nIn this case, it's ",(0,a.jsx)(n.code,{children:"operator-destination-service"}),".\nMake sure it matches exactly to the ",(0,a.jsx)(n.code,{children:"spec -> serviceInstanceName"})," field in the binding."]})}),"\n",(0,a.jsx)(n.h2,{id:"deploy-to-kubernetes",children:"Deploy to Kubernetes"}),"\n",(0,a.jsx)(n.p,{children:"This section covers the following:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"How to deploy an application to Kubernetes."}),"\n",(0,a.jsx)(n.li,{children:"How to consume the bound services in the application from within the cluster."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"containerize-the-application",children:"Containerize the Application"}),"\n",(0,a.jsxs)(n.p,{children:["Create a ",(0,a.jsx)(n.code,{children:"Dockerfile"})," defining a container for the application.\nThen it can be deployed to one or more Kubernetes Pods."]}),"\n",(0,a.jsx)(i.xV,{}),"\n",(0,a.jsx)(n.p,{children:"Compile and push the image by running:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker build -t <YOUR_REPO>/<YOUR_IMAGE_NAME>:<YOUR_TAG> .\ndocker push <YOUR_REPO>/<YOUR_IMAGE_NAME>:<YOUR_TAG>\n"})}),"\n",(0,a.jsx)(n.h3,{id:"create-a-deployment-configuration",children:"Create a Deployment Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Create a ",(0,a.jsx)(n.code,{children:"deployment.yml"})," file as shown below:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="app/deployment.yml"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: sdkjs-e2e-deployment\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: sdkjs-e2e\n  template:\n    metadata:\n      labels:\n        app: sdkjs-e2e\n    spec:\n      containers:\n        - name: sdkjs-e2e\n          image: <YOUR_REPO>/k8s-e2e-app:latest\n          resources:\n            requests:\n              memory: '256Mi'\n              cpu: '500m'\n            limits:\n              memory: '512Mi'\n              cpu: '1000m'\n          ports:\n            - containerPort: 3000\n          volumeMounts:\n            - name: destination-volume\n              mountPath: '/etc/secrets/sapcp/destination/operator-destination-service'\n              readOnly: true\n            - name: xsuaa-volume\n              mountPath: '/etc/secrets/sapcp/xsuaa/operator-xsuaa-service'\n              readOnly: true\n      imagePullSecrets:\n        - name: regcred\n      volumes:\n        - name: destination-volume\n          secret:\n            secretName: operator-destination-service\n        - name: xsuaa-volume\n          secret:\n            secretName: operator-xsuaa-service\n"})}),"\n",(0,a.jsx)(n.p,{children:"The file contains the following data:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Resources definition"}),": The ",(0,a.jsx)(n.code,{children:"requests"})," field specifies the CPU and memory requirements of the app.\nAdditionally, the resources can scale based on the values provided in the ",(0,a.jsx)(n.code,{children:"limits"})," field."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Service bindings"}),": the volumes ",(0,a.jsx)(n.code,{children:"destination-volume"})," and ",(0,a.jsx)(n.code,{children:"xsuaa-volume"})," reference the secrets (service bindings).\nThe volumes are mounted into the file system of your application at a specific path by adding them to the list of ",(0,a.jsx)(n.code,{children:"volumeMounts"})," in the ",(0,a.jsx)(n.code,{children:"containers"})," section.","\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["The path convention is provided by the ",(0,a.jsx)(n.a,{href:"https://www.npmjs.com/package/@sap/xsenv",children:"xsenv"})," library."]})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Container image and registry secrets"}),": ",(0,a.jsx)(n.code,{children:"regcred"})," secret used by the ",(0,a.jsx)(n.code,{children:"imagePullSecrets"})," config contains your registry credentials that you bound as a secret (in case the image was pushed to a private repository)."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Deploy the application by running the command:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"kubectl apply -f deployment.yml"})}),"\n",(0,a.jsx)(n.h3,{id:"access-your-application",children:"Access Your Application"}),"\n",(0,a.jsx)(n.p,{children:"To access the application, you have two options.\nEither expose it to the internet directly or port-forward to your local machine."}),"\n",(0,a.jsx)(n.h4,{id:"local-connection",children:"Local Connection"}),"\n",(0,a.jsxs)(n.p,{children:["Run the command ",(0,a.jsx)(n.code,{children:"kubectl port-forward deployment YOUR_DEPLOYMENT :3000"})," on your local machine to enable port forwarding.\nYour application will listen to port 3000.\nKubernetes finds an available port on your local machine and forwards port 3000 of your deployment to it.\nMake a call to the application via a provided link."]}),"\n",(0,a.jsx)(n.h4,{id:"internet-facing-connection",children:"Internet Facing Connection"}),"\n",(0,a.jsx)(n.admonition,{type:"danger",children:(0,a.jsxs)(n.p,{children:["Exposing an application this way is good only for testing.\n",(0,a.jsx)(n.strong,{children:"Don't use it in production."})]})}),"\n",(0,a.jsx)(n.p,{children:"Run the command below to expose the application to the internet.\nIt will use the cluster's IP address and the port the application listens on."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:'kubectl expose deployment YOUR_DEPLOYMENT --type="LoadBalancer"'})}),"\n",(0,a.jsx)(n.h3,{id:"configure-tls-and-obtain-a-domain-in-sap-gardener",children:"Configure TLS and Obtain a Domain in SAP Gardener"}),"\n",(0,a.jsxs)(n.p,{children:["If you want to expose your cluster under a domain name with TLS, check out the steps below or follow the official Kubernetes ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster/",children:"documentation"})," for a general setup."]}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{children:(0,a.jsx)(n.strong,{children:"Prerequisite"})}),(0,a.jsx)(n.p,{children:"Enable the NGINX Ingress add-on for your SAP Gardener cluster."})]}),"\n",(0,a.jsx)(n.p,{children:"The fastest way to enable TLS and obtain a domain for your application is to create a Service for your Deployment, and an Ingress to handle the routing.\nCreate a Service that contains your Deployment and the port you want to expose as shown in the example below:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="app/k8s-e2e-service.yml"',children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: sdkjs-e2e-svc\nspec:\n  selector:\n    app: sdkjs-e2e\n  ports:\n    - port: 8080\n      targetPort: 3000\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Check your shoot cluster's ",(0,a.jsx)(n.code,{children:"kubeconfig.yaml"})," for the configured DNS, which should be located in your Gardener project's dashboard, under the YAML tab.\nIt should be a field that looks like this:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spec:\n  dns:\n    domain: cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Since the NGINX Ingress is enabled, all domains have to follow the pattern ",(0,a.jsx)(n.code,{children:"*.ingress.YOUR_DNS"}),", for example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"e2e.ingress.cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com\n"})}),"\n",(0,a.jsx)(n.p,{children:"This is how the Ingress configuration file should look like:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="ingress.yml"',children:'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: sdkjs-e2e-ingress\n  annotations:\n    cert.gardener.cloud/purpose: managed\nspec:\n  tls:\n    - hosts:\n        - cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com # - "<YOUR_DNS>"\n        - e2e.ingress.cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com # - "*.ingress.<YOUR_DNS>"\n      secretName: secret-tls\n  rules:\n    - host: e2e.ingress.cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: sdkjs-e2e-svc\n                port:\n                  number: 8080\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Notice how the Ingress uses the annotation ",(0,a.jsx)(n.code,{children:"cert.gardener.cloud/purpose: managed"}),", which is important so that SAP Gardener manages TLS."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"spec.tls.hosts"})," config exposes 2 domains.\nThe first one is your default domain, limited to a maximum of 64 characters.\nOther domains can be any size, but should follow the Ingress pattern."]}),"\n",(0,a.jsxs)(n.p,{children:["The field ",(0,a.jsx)(n.code,{children:"secretName: secret-tls"})," in the configuration implies that all TLS certificates will be saved by SAP Gardener.\nFinally, look at how to serve the Service at the root of your subdomain.\nThis way the Service is exposed to the internet using TLS."]}),"\n",(0,a.jsx)(n.h3,{id:"expose-the-application-using-approuter",children:"Expose the Application using approuter"}),"\n",(0,a.jsxs)(n.p,{children:["In the next steps, you will configure and deploy an approuter so that only users authenticated by your identity provider can access the application endpoints.\nFor that, create a ",(0,a.jsx)(n.a,{href:"https://github.com/SAP-samples/cloud-sdk-js/tree/main/samples/k8s-sample-application/approuter",children:"simple application"})," that uses the @sap/approuter."]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Package the application router as a docker image so that it can run in Kubernetes, refer to the ",(0,a.jsx)(n.a,{href:"https://blogs.sap.com/2020/04/03/sap-application-router/",children:"documentation"})," for configuration details."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Create a Kubernetes Deployment and a Kubernetes Service to run and expose the application router."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="approuter/deployment.yml"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: approuter\n  labels:\n    app: approuter\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: approuter\n  template:\n    metadata:\n      labels:\n        app: approuter\n    spec:\n      containers:\n        - image: <YOUR_REPO>/k8s-approuter:latest\n          resources:\n            requests:\n              memory: '256Mi'\n              cpu: '250m'\n            limits:\n              memory: '512Mi'\n              cpu: '500m'\n          name: approuter\n          volumeMounts:\n            - name: xsuaa-volume\n              mountPath: '/etc/secrets/sapcp/xsuaa/operator-xsuaa-service'\n              readOnly: true\n          env:\n            - name: PORT\n              value: '5000'\n            - name: destinations\n              value: '[{\"name\":\"backend\", \"url\":\"http://sdkjs-e2e-svc:8080/\", \"forwardAuthToken\": true}]'\n      imagePullSecrets:\n        - name: regcred\n      volumes:\n        - name: xsuaa-volume\n          secret:\n            secretName: operator-xsuaa-service\n"})}),"\n",(0,a.jsx)(n.p,{children:"It references the application running in your cluster.\nInstead of an Ingress endpoint, it directly points to the Service.\nThis is possible because the application router runs in your cluster and can therefore use the Kubernetes native Service discovery."}),"\n",(0,a.jsx)(n.p,{children:"The Service configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="approuter/approuter-service.yml"',children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: approuter-svc\n  labels:\n    app: approuter\nspec:\n  ports:\n    - port: 8080\n      targetPort: 5000\n  selector:\n    app: approuter\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsxs)(n.li,{children:["Finally, configure the Ingress to create a session cookie that is consumed by the application router.\nSet the ",(0,a.jsx)(n.code,{children:"backend.service.name"})," to ",(0,a.jsx)(n.code,{children:"approuter-svc"})," to point the Ingress to the ",(0,a.jsx)(n.code,{children:"approuter"})," Service.\nTo secure your application, remove all previous routes that pointed to your application's endpoints and only expose them through the application router.\nFor that, specify the Service names in your approuter destinations' configuration and remove the rules you previously created for these endpoints in the Ingress."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Depending on the Ingress controller, you have to use different annotations.\nAn Ingress that only exposes the application router and uses the annotations is shown in the following example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="ingress.yml"',children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: sdkjs-e2e-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/affinity: 'cookie'\n    nginx.ingress.kubernetes.io/proxy-read-timeout: '600'\n    nginx.ingress.kubernetes.io/session-cookie-name: 'JSESSIONID'\n    cert.gardener.cloud/purpose: managed\nspec:\n  tls:\n    - hosts:\n        - cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com\n        - e2e.ingress.cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com\n      secretName: secret-tls\n  rules:\n    - host: e2e.ingress.cloud-sdk-js.sdktests.shoot.canary.k8s-hana.ondemand.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: approuter-svc\n                port:\n                  number: 8080\n"})}),"\n",(0,a.jsx)(n.h3,{id:"on-premise-connectivity",children:"On-Premise Connectivity"}),"\n",(0,a.jsx)(i.VD,{})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},12810:(e,n,t)=>{t.d(n,{VD:()=>v,WL:()=>u,aQ:()=>p,lz:()=>h,s4:()=>m,xV:()=>d});t(96540);var s=t(21026),a=t(74434),r=t(59116),i=t(59239),o=t(81940),c=t(89625),l=t(74848);function d(){return(0,l.jsx)(r.default,{})}function u(){return(0,l.jsx)(i.default,{})}function p(){return(0,l.jsx)(o.default,{})}function h(){return(0,l.jsx)(s.default,{})}function m(){return(0,l.jsx)(a.default,{})}function v(){return(0,l.jsx)(c.default,{})}},79329:(e,n,t)=>{t.d(n,{A:()=>i});t(96540);var s=t(34164);const a={tabItem:"tabItem_Ymn6"};var r=t(74848);function i(e){let{children:n,hidden:t,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(a.tabItem,i),hidden:t,children:n})}},65537:(e,n,t)=>{t.d(n,{A:()=>k});var s=t(96540),a=t(34164),r=t(65627),i=t(56347),o=t(50372),c=t(30604),l=t(11861),d=t(78749);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:s,default:a}}=e;return{value:n,label:t,attributes:s,default:a}}))}(t);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function h(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const a=(0,i.W6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,c.aZ)(r),(0,s.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})}),[r,a])]}function v(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,r=p(e),[i,c]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[l,u]=m({queryString:t,groupId:a}),[v,g]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,r]=(0,d.Dv)(t);return[a,(0,s.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:a}),x=(()=>{const e=l??v;return h({value:e,tabValues:r})?e:null})();(0,o.A)((()=>{x&&c(x)}),[x]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!h({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),g(e)}),[u,g,r]),tabValues:r}}var g=t(9136);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(74848);function y(e){let{className:n,block:t,selectedValue:s,selectValue:i,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),d=e=>{const n=e.currentTarget,t=c.indexOf(n),a=o[t].value;a!==s&&(l(n),i(a))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:r}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...r,className:(0,a.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":s===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:r}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function j(e){const n=v(e);return(0,f.jsxs)("div",{className:(0,a.A)("tabs-container",x.tabList),children:[(0,f.jsx)(y,{...n,...e}),(0,f.jsx)(b,{...n,...e})]})}function k(e){const n=(0,g.A)();return(0,f.jsx)(j,{...e,children:u(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(96540);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);