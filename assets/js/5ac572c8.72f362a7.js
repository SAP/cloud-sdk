"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[35447],{54634:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"features/openapi/pregenerated-clients/workflow","title":"Use the Pregenerated Workflow API Client for Cloud Foundry","description":"This article describes what the Workflow API for Cloud Foundry is and how to consume it with the SAP Cloud SDK.","source":"@site/docs-js_versioned_docs/version-v1/features/openapi/pregenerated-clients/workflow.mdx","sourceDirName":"features/openapi/pregenerated-clients","slug":"/features/openapi/pregenerated-clients/workflow","permalink":"/cloud-sdk/docs/js/v1/features/openapi/pregenerated-clients/workflow","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/cloud-sdk/edit/main/docs-js_versioned_docs/version-v1/features/openapi/pregenerated-clients/workflow.mdx","tags":[],"version":"v1","frontMatter":{"title":"Use the Pregenerated Workflow API Client for Cloud Foundry","sidebar_label":"SAP Workflow API for Cloud Foundry","description":"This article describes what the Workflow API for Cloud Foundry is and how to consume it with the SAP Cloud SDK.","keywords":["sap","cloud","sdk","OpenAPI","REST","JavaScript","TypeScript"]},"sidebar":"docsJsSidebar","previous":{"title":"Execute an OpenAPI Request","permalink":"/cloud-sdk/docs/js/v1/features/openapi/execute-request"},"next":{"title":"Error Handling","permalink":"/cloud-sdk/docs/js/v1/features/error-handling"}}');var o=t(74848),i=t(28453),r=t(86025);const a={title:"Use the Pregenerated Workflow API Client for Cloud Foundry",sidebar_label:"SAP Workflow API for Cloud Foundry",description:"This article describes what the Workflow API for Cloud Foundry is and how to consume it with the SAP Cloud SDK.",keywords:["sap","cloud","sdk","OpenAPI","REST","JavaScript","TypeScript"]},c=void 0,l={},d=[{value:"Installation",id:"installation",level:2},{value:"Use the Client",id:"use-the-client",level:2},{value:"Start a Workflow",id:"start-a-workflow",level:3},{value:"Retrieve Tasks of a Workflow Instance",id:"retrieve-tasks-of-a-workflow-instance",level:3},{value:"Update the Status and Context of a Task",id:"update-the-status-and-context-of-a-task",level:3},{value:"Retrieve Execution Logs",id:"retrieve-execution-logs",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://help.sap.com/viewer/product/WORKFLOW_SERVICE/Cloud/en-US",children:"SAP Workflow service"})," allows you to automate business processes across organizations and applications on SAP Business Technology Platform, both Cloud Foundry and Neo environment.\nIt is technically separated into two services per environment:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Inbox API (OData)"}),"\n",(0,o.jsx)(n.li,{children:"Workflow API (OpenAPI)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The Inbox API is mainly meant to build a personal inbox, while the Workflow API helps to manage workflows and tasks across recipients."}),"\n",(0,o.jsx)(n.p,{children:"The first SAP Cloud SDK pregenerated OpenAPI client is for the Workflow API.\nThere is no pregenerated client for the Inbox API, yet.\nThe remainder of this document refers to the OpenAPI Workflow API for Cloud Foundry only."}),"\n",(0,o.jsxs)(n.admonition,{title:"Prerequisites",type:"note",children:[(0,o.jsx)(n.p,{children:"The following documentation explains how to use the pregenerated client for:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"An existing instance of the SAP Workflow service"}),"\n",(0,o.jsx)(n.li,{children:"A user, who has the necessary roles to make the requests"}),"\n",(0,o.jsx)(n.li,{children:"An existing workflow definition that contains one simple user task"}),"\n"]}),(0,o.jsxs)(n.p,{children:["To learn how to set up your environment for the SAP Workflow service, see the ",(0,o.jsx)(n.a,{href:"https://help.sap.com/viewer/e157c391253b4ecd93647bf232d18a83/Cloud/en-US/fc3d44872c354742afd672aa8d9c16b4.html",children:"Workflow service documentation"}),"."]})]}),"\n",(0,o.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,o.jsx)(n.p,{children:"The client for the Workflow API is available as an npm package.\nTo install it, run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ npm install @sap/cloud-sdk-workflow-service-cf\n"})}),"\n",(0,o.jsx)(n.h2,{id:"use-the-client",children:"Use the Client"}),"\n",(0,o.jsx)(n.p,{children:"For this example, assume the following workflow definition:"}),"\n",(0,o.jsx)("img",{src:(0,r.Ay)("img/workflow-definition.png"),style:{width:"50%"}}),"\n",(0,o.jsxs)(n.p,{children:["It contains one task definition to approve a request through a form with one boolean field, ",(0,o.jsx)(n.code,{children:"approve"}),".\nThe use case shows how to initiate a workflow, retrieve its tasks, complete a task, and retrieve the execution logs."]}),"\n",(0,o.jsx)(n.h3,{id:"start-a-workflow",children:"Start a Workflow"}),"\n",(0,o.jsxs)(n.p,{children:["First, import the ",(0,o.jsx)(n.code,{children:"WorkflowInstancesApi"})," from the Workflow API client.\nThis API includes functionality to manage workflow instances.\nIt allows you to start an instance of a workflow for an existing definition.\nUse the ",(0,o.jsx)(n.code,{children:"startInstance"})," function to build a request to start a workflow instance for the definition with the ID ",(0,o.jsx)(n.code,{children:"'myWorkflowDefinitionId'"})," and execute it against a ",(0,o.jsx)(n.a,{href:"/cloud-sdk/docs/js/v1/features/connectivity/destinations",children:"destination"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { WorkflowDefinitionsApi } from '@sap/cloud-sdk-workflow-service-cf';\n\nfunction startWorkflow(): Promise<WorkflowInstance> {\n  return WorkflowInstancesApi.startInstance({\n    definitionId: 'myWorkflowDefinitionId'\n  }).execute(destination);\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"The returned workflow instance looks something like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "id": "<workflowInstanceId>",\n  "definitionId": "myworkflow",\n  "definitionVersion": "2",\n  "subject": "MyWorkflow",\n  "status": "RUNNING",\n  "businessKey": "",\n  "parentInstanceId": null,\n  "rootInstanceId": "<workflowInstanceId>",\n  "applicationScope": "own",\n  "startedAt": "2021-05-28T07:54:14.492Z",\n  "startedBy": "<serviceClientId>",\n  "completedAt": null\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["It contains information on the started workflow, for example, ",(0,o.jsx)(n.code,{children:"id"}),", the ID of the instance, ",(0,o.jsx)(n.code,{children:"defintionId"}),", the ID of the definition, and ",(0,o.jsx)(n.code,{children:"status"}),", which in this case is ",(0,o.jsx)(n.code,{children:"'RUNNING'"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"retrieve-tasks-of-a-workflow-instance",children:"Retrieve Tasks of a Workflow Instance"}),"\n",(0,o.jsxs)(n.p,{children:["To get the tasks that are part of an instance, use the ",(0,o.jsx)(n.code,{children:"UserTaskInstancesApi"}),".\nIt includes functionality around managing user tasks.\nTo retrieve the tasks of a workflow, use the ",(0,o.jsx)(n.code,{children:"queryInstances"})," function and pass the workflow instance ID as query parameter to filter the tasks by your workflow instance.\nExecute the request against a destination:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { UserTaskInstancesApi } from '@sap/cloud-sdk-workflow-service-cf';\n\nasync function getTask(\n  workflowInstance: WorkflowInstance\n): Promise<TaskInstance> {\n  const [taskInstance] = await UserTaskInstancesApi.queryInstances({\n    workflowInstanceId: workflowInstance.id\n  }).execute(destination);\n\n  return taskInstance;\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"The function above returns an instance of a task, that looks as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "activityId": "usertask1",\n  "claimedAt": null,\n  "completedAt": null,\n  "createdAt": "2021-05-28T07:54:14.748Z",\n  "description": null,\n  "id": "<userTaskInstanceId>",\n  "processor": null,\n  "recipientUsers": ["<userId>"],\n  "recipientGroups": [],\n  "status": "READY",\n  "subject": "Approve a request",\n  "workflowDefinitionId": "myworkflow",\n  "workflowInstanceId": "<workflowInstanceId>",\n  "priority": "MEDIUM",\n  "dueDate": null,\n  "createdBy": "<serviceClientId>",\n  "definitionId": "usertask1@myworkflow",\n  "lastChangedAt": "2021-05-28T07:54:14.748Z",\n  "applicationScope": "own"\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This is an object with data on the task.\nIt has properties like the ID of the instance and definition (",(0,o.jsx)(n.code,{children:"id"})," and ",(0,o.jsx)(n.code,{children:"definitionId"}),"), the ",(0,o.jsx)(n.code,{children:"status"}),", ",(0,o.jsx)(n.code,{children:"priority"}),", and so on."]}),"\n",(0,o.jsx)(n.h3,{id:"update-the-status-and-context-of-a-task",children:"Update the Status and Context of a Task"}),"\n",(0,o.jsxs)(n.p,{children:["To update a task, use the ",(0,o.jsx)(n.code,{children:"updateInstance"})," on the ",(0,o.jsx)(n.code,{children:"UserTaskInstancesApi"}),".\nPass the mandatory instance ID as first parameter.\nThe second parameter is the body to be sent with the update.\nIs has the type ",(0,o.jsx)(n.code,{children:"UpdateTaskInstancePayload"})," and allows you to pass the parameters ",(0,o.jsx)(n.code,{children:"context"})," and ",(0,o.jsx)(n.code,{children:"status"}),", among others.\nIn this example the task requires to give (or not to give) an approval.\nThe form to execute this task has one boolean field, ",(0,o.jsx)(n.code,{children:"approve"}),":"]}),"\n",(0,o.jsx)("img",{src:(0,r.Ay)("img/workflow-task-form.png"),style:{width:"50%"}}),"\n",(0,o.jsxs)(n.p,{children:["It is defined to point to the context path ",(0,o.jsx)(n.code,{children:"${context.approve}"}),".\nTherefore, you can set it on the context in the request body as in the example below.\nTo complete the action, you can also set the ",(0,o.jsx)(n.code,{children:"status"})," to ",(0,o.jsx)(n.code,{children:"'COMPLETED'"}),".\nAs in this example, this is the only task, it will also complete the workflow.\nExecute the request against a destination:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { UserTaskInstancesApi } from '@sap/cloud-sdk-workflow-service-cf';\n\nfunction updateTask(taskInstance: TaskInstance): Promise<void> {\n  return UserTaskInstancesApi.updateInstance(taskInstance.id, {\n    context: {\n      approve: true\n    },\n    status: 'COMPLETED'\n  }).execute(destination);\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"retrieve-execution-logs",children:"Retrieve Execution Logs"}),"\n",(0,o.jsxs)(n.p,{children:["Every workflow tracks information on the events that occurred throughout its execution.\nThe ",(0,o.jsx)(n.code,{children:"WorkflowInstanceApi"})," provides the ",(0,o.jsx)(n.code,{children:"queryInstanceExecutionLogs"})," function to retrieve the current logs for a workflow.\nPass the ID of the workflow to this function and execute it against a destination to retrieve the logs:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { WorkflowInstancesApi } from '@sap/cloud-sdk-workflow-service-cf';\n\nfunction getLogs(\n  workflowInstance: WorkflowInstance\n): Promise<WorkflowInstanceExecutionLog[]> {\n  return WorkflowInstancesApi.queryInstanceExecutionLogs(\n    workflowInstance.id\n  ).execute(destination);\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"The returned logs for this exemplary use case would look something like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "id": "48",\n    "type": "WORKFLOW_STARTED",\n    "timestamp": "2021-05-28T07:54:14.501Z",\n    "referenceInstanceId": "<workflowInstanceId>",\n    "userId": "<serviceClientId>"\n  },\n  {\n    "id": "49",\n    "type": "USERTASK_CREATED",\n    "timestamp": "2021-05-28T07:54:14.769Z",\n    "referenceInstanceId": "dd25391e-e426-49bf-bfbc-2e58d33fb4a8",\n    "activityId": "usertask1",\n    "subject": "Approve a request",\n    "recipientUsers": ["<userId>"],\n    "recipientGroups": [],\n    "initiatorId": "<serviceClientId>",\n    "taskId": "<userTaskInstanceId>"\n  },\n  {\n    "id": "50",\n    "type": "USERTASK_COMPLETED",\n    "timestamp": "2021-05-28T07:54:16.407Z",\n    "referenceInstanceId": "dd25391e-e426-49bf-bfbc-2e58d33fb4a8",\n    "activityId": "usertask1",\n    "userId": "<serviceClientId>",\n    "subject": "Approve a request",\n    "taskId": "<userTaskInstanceId>"\n  }\n]\n'})}),"\n",(0,o.jsx)(n.p,{children:"The three items represented here are the initiation of the workflow, the creation of the task, and the completion of the task."})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(96540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);