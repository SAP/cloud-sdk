---
id: 5.0-upgrade-steps
title: Steps to update to Version 5 of the SAP Cloud SDK
hide_title: false
hide_table_of_contents: false
sidebar_label: Update Steps to Version 5
description: Update your application to use version 5 of the SAP Cloud SDK
keywords:
  - sap
  - cloud
  - sdk
  - cloud native
  - cloud sdk
  - sap cloud sdk
  - 5
  - Update
---

Version 5 of the SAP Cloud SDK is here and we highly recommend updating to it as soon as possible.
It brings various improvements while keeping the necessary adjustments to an absolute minimum.

There is a good chance that just bumping the version to `5.0.0` is already enough, without the need for any further adjustments.
In particular, updating may be straightforward if you are not using any deprecated API.

:::note Release Blog Post
For more information also check out our version 5 release blog post
:::

:::warning Minumum Java Version
Starting with version 5.0.0 the SAP Cloud SDK requires a Java version of at least 17.
:::

:::info Minumum CAP version
If you are using the Cloud Application Programming model (CAP) to build your application, please note that the SAP Cloud SDK version 5 requires a minimum CAP/CDS version of at least `2.4.0`.
If you are on an older CAP stack, please follow the [CAP migration guide](https://cap.cloud.sap/docs/java/migration#one-to-two) first.
:::

## Before You Update

Before you increase the SAP Cloud SDK version to 5, it is recommended to first update to the latest available version of the SAP Cloud SDK 4 and migrate any usage of deprecated API. Follow the deprecation notes in the Javadocs to find recommended replacements. All deprecated APIs are removed with version 5.

Also, make sure that you are using Java 17 or higher. To setup your build to use Java 17 you can use [this guide](https://www.baeldung.com/maven-java-version).
As Java EE modules have been removed from Java 11, you might also need to update your application to use the [Jakarta EE](https://jakarta.ee/) modules instead.
This JEP provides a good overview of the changes: [JEP 320: Remove the Java EE and CORBA Modules](https://openjdk.java.net/jeps/320).

## Change Version of Your `sdk-bom` or `sdk-modules-bom`

The first step is to change the version of the SAP Cloud SDK dependency in your `pom.xml` file.
Depending on your project setup you might use one of our BOMs or the individual modules.

To find our BOMs, search for the following entries in your maven `dependencyManagement` section: `com.sap.cloud.sdk:sdk-bom` and `com.sap.cloud.sdk:sdk-modules-bom`.
Update them directly to version `5.0.0` or the [latest version](https://central.sonatype.com/artifact/com.sap.cloud.sdk/sdk-bom).

If you are using `com.sap.cloud.sdk:sdk-sjb-bom` and produce a `war` deployment (e.g. when you require JCo for your application) you will need to stay on the latest version 4 of the SAP Cloud SDK.
In the other cases you should replace it with one of the BOMs mentioned above.

If you are building on Spring or Spring Boot you should also update to the latest version of the respective BOMs, so `6.1.0` (Spring) or `3.1.6` (Spring Boot) as of the time of writing.
These BOMs should be listed after any SAP Cloud SDK related BOM, so for Spring Boot your `dependencyManagement` section should look something like this:

```xml
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>com.sap.cloud.sdk</groupId>
            <artifactId>sdk-bom</artifactId>
            <version>5.0.0</version> <!-- TODO: replace this with the most recent version -->
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>3.1.6</version> <!-- TODO: replace this with the most recent version -->
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

At the same time you should also replace usages of `javax` dependencies with the respective `jakarta` dependency:

```diff
-<dependency>
-    <groupId>javax.inject</groupId>
-    <artifactId>javax.inject</artifactId>
-</dependency>
+<dependency>
+    <groupId>jakarta.inject</groupId>
+    <artifactId>jakarta.inject-api</artifactId>
+</dependency>
```

Also remember to migrate all your dependencies to their respective `jakarta` versions if applicable.

For example, if you were previously using `com.sap.hcp.cf.logging:cf-java-logging-support-servlet` for application logging you must instead switch to using `com.sap.hcp.cf.logging:cf-java-logging-support-servlet-jakarta`.

```diff
-<dependency>
-    <groupId>com.sap.hcp.cf.logging</groupId>
-    <artifactId>cf-java-logging-support-servlet</artifactId>
-</dependency>
+<dependency>
+    <groupId>com.sap.hcp.cf.logging</groupId>
+    <artifactId>cf-java-logging-support-servlet-jakarta</artifactId>
+    <version>latest-lib-version</version>
+</dependency>
```

<details>
<summary>For projects that were already upgraded to Java 17 and Spring Boot 3 in SDK 4</summary>

Please remove any workarounds that were needed to make Java 17 and Spring Boot 3 work with SDK 4:
- When using the `scp-cf` module or its replacement `sdk-core`, please remove the `servlet-jakarta` module.
- When using the `@ServletComponentScan` annotation, please update the namespace back to:

```diff
- @ServletComponentScan({"com.sap.cloud.sdk.cloudplatform.servletjakarta", ...
+ @ServletComponentScan({"com.sap.cloud.sdk", ...
```

</details>

## Remove or Replace Modified Cloud SDK Dependencies

The lists below contains all modules that have been renamed or removed from the SDK.
Therefore, you should also rename respectively remove those from your project setup.

<details>
  <summary>Full list of renamed or replaced modules</summary>

- Module `com.sap.cloud.sdk.frameworks:resilience4j` has been moved to `com.sap.cloud.sdk.cloudplatform:resilience4j`
- Module `com.sap.cloud.sdk.frameworks:apache-httpclient5` has been moved to `com.sap.cloud.sdk.cloudplatform:connectivity-apache-httpclient5`
- Module `com.sap.cloud.sdk.cloudplatform:servlet` has been removed and functionally replaced by `com.sap.cloud.sdk.cloudplatform:servlet-jakarta` (replacing usage of `javax.servlet` with `jakarta.servlet`)
- Module `com.sap.cloud.sdk.cloudplatform:scp-cf` has been deprecated and functionally replaced by `com.sap.cloud.sdk:sdk-core`

</details>

<details>
    <summary>Full list of removed modules</summary>

- Bill of Materials
  - `com.sap.cloud.sdk:sdk-sjb-bom`
- Archetypes
  - `com.sap.cloud.sdk.archetypes:scp-cf-tomee`
  - `com.sap.cloud.sdk.archetypes:scp-neo-javaee7`
- Neo related modules
  - `com.sap.cloud.sdk.cloudplatform:auditlog-scp-neo`
  - `com.sap.cloud.sdk.cloudplatform:cloudplatform-connectivity-scp-neo`
  - `com.sap.cloud.sdk.cloudplatform:cloudplatform-core-scp-neo`
  - `com.sap.cloud.sdk.cloudplatform:concurrency-scp-neo`
  - `com.sap.cloud.sdk.cloudplatform:scp-neo`
  - `com.sap.cloud.sdk.cloudplatform:security-scp-neo`
  - `com.sap.cloud.sdk.cloudplatform:tenant-scp-neo`
  - `com.sap.cloud.sdk.plugins:scp-neo-maven-plugin`
- Generator CLIs
  - `com.sap.cloud.sdk.datamodel:odata-generator-cli`
  - `com.sap.cloud.sdk.datamodel:odata-v4-generator-cli`
  - `com.sap.cloud.sdk.datamodel:openapi-generator-cli`
- Pregenerated Clients
  - `com.sap.cloud.sdk.s4hana:s4hana-all`
  - `com.sap.cloud.sdk.s4hana:s4hana-api-odata`
  - `com.sap.cloud.sdk.s4hana:s4hana-api-odata-onpremise`
  - `com.sap.cloud.sdk.s4hana:s4hana-api-odata-v4`
  - `com.sap.cloud.sdk.s4hana:s4hana-api-odata-v4-onpremise`
- Services
  - `com.sap.cloud.sdk.services:blockchain-business-services-sdk`
  - `com.sap.cloud.sdk.services:blockchain-business-services-visibility`
  - `com.sap.cloud.sdk.services:blockchain-client-fabric`
  - `com.sap.cloud.sdk.services:blockchain-client-multichain`
  - `com.sap.cloud.sdk.services:btp-business-rules`
  - `com.sap.cloud.sdk.services:btp-shared-ledger-client`
  - `com.sap.cloud.sdk.services:scp-blockchain`
  - `com.sap.cloud.sdk.services:scp-business-logging-all`
  - `com.sap.cloud.sdk.services:scp-business-logging-core`
  - `com.sap.cloud.sdk.services:scp-business-logging-odata`
  - `com.sap.cloud.sdk.services:scp-business-logging-rest`
  - `com.sap.cloud.sdk.services:scp-workflow-cf`
- Others
  - `com.sap.cloud.sdk.cloudplatform:auditlog`
  - `com.sap.cloud.sdk.cloudplatform:auditlog-scp-cf`
  - `com.sap.cloud.sdk.cloudplatform:cloudplatform-connectivity-scp`
  - `com.sap.cloud.sdk.cloudplatform:cloudplatform-core-scp-cf`
  - `com.sap.cloud.sdk.cloudplatform:security-scp-cf`
  - `com.sap.cloud.sdk.cloudplatform:security-servlet`
  - `com.sap.cloud.sdk.cloudplatform:tenant-scp-cf`

</details>

If you are using our BOMs to provide the module versions, a fast way to do identify those is to run any `mvn` command.
This will now lead to error messages like this:

> 'dependencies.dependency.version' for com.sap.cloud.sdk.cloudplatform:auditlog-scp-cf:jar is missing

This helps you to identify which modules you need to remove or replace in your project setup.

## Steps to migrate `Destination` usages

Version 5 of the SAP Cloud SDK comes with a major cleanup of the APIs around the `Destination` concept.
Luckily, this cleanup comes **without a lot of breaking changes** so that existing applications require only a minimum of adjustments.
To make the process of adjusting existing applications as easy as possible, please follow the below steps:

1.  Remove any invocation of `Destination#decorate`.
    This method was only really used in conjunction with the `DefaultErpHttpDestination`, which has been removed in this major version update.
    The functionality has been moved internally, so that decorating existing `Destination` instances is no longer needed.

2.  (Optional) Remove any invocations of `Destination#asHttp` or `Destination#asRfc`.
    A big part of the `Destination` cleanup was to straighten our public APIs that previously expected specific sub-types of `Destination` or `DestinationProperties` (e.g. `HttpClientAccessor#getHttpClient(HttpDestinationProperties)`).
    These APIs now all simply rely on `Destination`, which makes casting via `#asHttp` or `#asRfc` unnecessary.

3.  Adjust error handling.
    Prior to version 5 of the SAP Cloud SDK, `Destination#asHttp` would throw an Exception in case the Destination Service wasn't able to provide valid `Authorization` header suggestions.
    This has been changed so that `asHttp` will no longer throw an Exception.
    Instead, calling the `getHeaders` method on an `HttpDestination` will throw an exception if any `Authorization` header suggestion provided by the Destination service contained an error.

    This change is **important** to keep in mind because it influences where applications are expected to catch Exceptions as the `getHeaders` method will be called during request execution.

<details>
<summary>Example</summary>

Given the following code:

```java
Try<Destination> maybeDestination = DestinationAccessor.tryGetDestination("my-destination");
if (maybeDestination.isFailure()) {
    throw new IllegalStateException("Unable to retrieve 'my-destination'.", maybeDestination.getCause());
}

HttpDestination httpDestination;
try {
    httpDestination = maybeDestination.get().asHttp();
} catch (DestinationAccessException e) {
    throw new IllegalStateException("Destination service wasn't able to provide a valid HTTP destination.", e);
}

try {
    new MyODataService().getAllEntities().executeRequest(httpDestination);
} catch (ODataException e) {
    throw new IllegalStateException("Unable to retrieve odata entities.", e);
}
```

The code should be updated like this:

```diff
Try<Destination> maybeDestination = DestinationAccessor.tryGetDestination("my-destination");
if (maybeDestination.isFailure()) {
    throw new IllegalStateException("Unable to retrieve 'my-destination'.", maybeDestination.getCause());
}

- HttpDestination httpDestination;
- try {
-   httpDestination = maybeDestination.get().asHttp();
- } catch (DestinationAccessException e) {
-   throw new IllegalStateException("Destination service wasn't able to provide a valid HTTP destination.", e);
- }

try {
-   new MyODataService().getAllEntities().executeRequest(httpDestination);
+   new MyODataService().getAllEntities().executeRequest(maybeDestination.get());
+ } catch (DestinationAccessException e) {
+   throw new IllegalStateException("Destination service wasn't able to provide a valid HTTP destination.", e);
} catch (ODataException e) {
    throw new IllegalStateException("Unable to retrieve odata entities.", e);
}
```

</details>

4.  Replace any of the removed classes related to the `Destination` API as mentioned in the [list of removed APIs](#list-of-apis-that-have-been-removed-with-version-5).

## Introduce Missing Modules Based on Package Names

Once the build doesn't complain about missing dependency versions anymore, you can start to fix the compilation errors.
For this, the following table provides a helpful overview, over which packages can be found in which module.

:::warning TODO

check for further packages and remove lines for deprecated modules

:::

| Package                                             | Module                                                                                   |
| --------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| `com.sap.cloud.sdk.s4hana.serialization`            | `com.sap.cloud.sdk.datamodel:odata-core`                                                 |
| `com.sap.cloud.sdk.s4hana.connectivity.exception`   | `com.sap.cloud.sdk.s4hana:s4hana-connectivity` (TODO: deprecated?)                       |
| `com.sap.cloud.sdk.s4hana.connectivity.rfc`         | `com.sap.cloud.sdk.s4hana:rfc` (TODO: deprecated?)                                       |
| `com.sap.cloud.sdk.s4hana.datamodel.odata.services` | See the section below on [generating your own OData VDM](#4-generate-your-own-odata-vdm) |
| `com.sap.cloud.sdk.cloudplatform.servlet`           | `com.sap.cloud.sdk.cloudplatform:servlet` dependency                                     |

## Generate and Use Your Own OData VDM

### Generate Your Own OData VDM

The SAP Cloud SDK no longer provides pre-generated OData VDMs. We made this decision to reduce the maintenance effort and to allow you to generate your own VDM with the exact version of the OData service you are using. That way there is no need to wait for the next SDK release to get the latest changes of an OData service you are consuming.

To generate your own OData VDM, you can use the [OData Generator Maven Plugin](../features/odata/vdm-generator) directly.
You can use the following configuration to generate a VDM that is compatible with the OData VDM the SDK provided in version 4:

```xml
<inputDirectory>${project.basedir}/src/main/resources/odata/edmx</inputDirectory>
<outputDirectory>${project.build.directory}/vdm</outputDirectory>
<serviceNameMappingFile>${project.basedir}/src/main/resources/odata/serviceNameMappings.properties</serviceNameMappingFile>
<deleteOutputDirectory>true</deleteOutputDirectory>
<packageName>com.sap.cloud.sdk.s4hana.datamodel.odata</packageName>
<compileScope>COMPILE</compileScope>
```

The file specified under _serviceNameMappingFile_ will be created and populated, if it doesn't exist yet.
If you want to create a VDM that is compatible with the OData VDM the SDK provided in version 4, you can use this [_serviceNameMappings.properties_](../../../static/resources/v4-serviceNameMappings.properties).

### Handle OData VDM Instantiation

Depending on your project setup, you might have relied on the `@Inject` annotation in your OData VDM services.
As the OData generators don't generate the `javax.inject.Named` annotations anymore, you will need to instantiate your own services instead.
For that you can either use your own dependency injection framework, or instantiate the services manually.

The manual approach would look something like this:

```diff
- @Inject
- private BusinessPartnerService businessPartnerService;
+ private BusinessPartnerService businessPartnerService = new DefaultBusinessPartnerService();
```

## Remove Discontinued ServletFilter from Your `web.xml`

We decided to remove all security related `Filter` implementations from the SAP Cloud SDK, to have a clearer separation between the [SAP Security Libraries](https://github.com/SAP/cloud-security-services-integration-library/) and the SAP Cloud SDK.

This means you need to remove all mentions of the following filters from your `web.xml` (mind the `security` in the package): `com.sap.cloud.sdk.cloudplatform.security.servlet.*Filter`

The `com.sap.cloud.sdk.cloudplatform.servlet.RequestAccessorFilter` remains in the SDK, as it is not security related.
