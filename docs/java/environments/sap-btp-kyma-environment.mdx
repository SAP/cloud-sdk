---
title: Develop your App for the Kyma Environment with Java SDK
sidebar_label: SAP Kyma
description: Learn how to develop an application with the SAP Cloud SDK for Java in the Kyma environment
keywords:
  - sap
  - cloud
  - sdk
  - cloud native
  - cloud sdk
  - sap cloud sdk
---

[Kyma](https://kyma-project.io/) is an application runtime that provides you a flexible and easy way to connect, extend, and customize your applications in the cloud-native world of Kubernetes.
Find more details in the [official documentation](https://kyma-project.io/docs/kyma/latest/01-overview/).

## SAP Cloud SDK Features Supported on Kyma by SAP

Find below the list of features we currently support:
Legend: ✅ - supported, ❗- partially supported, ❌ - not supported

- ✅ Consume SAP BTP services like Destination, Connectivity, IAS, XSUAA, and others
- ❗ Multitenancy (Access to IAS based Principal not yet supported)
- ❗ Resilience & Caching (Caching with IAS based Principal not yet supported)
- ✅ Connect to and consume services from SAP S/4HANA Cloud
- ✅ Connect to and consume services from SAP S/4HANA On-Premise
- ✅ Seamless use of typed clients provided by the SAP Cloud SDK

## Getting Started with the SAP Cloud SDK on Kyma

This detailed guide will help get your SAP Cloud SDK Java application up and running in Kyma.
You can also use this guide to migrate your existing application to Kyma.

### Prerequisites

To follow this guide you will need:
- An [SAP BTP Kyma environment](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/09dd313bf6644250a14f8f38c3d644c0.html?locale=en-US) instance
- [Docker](https://www.docker.com/) and a publicly reachable Docker repository
- A [Spring Boot](https://spring.io/projects/spring-boot) Application using the SAP Cloud SDK

Check out the details below in case you are uncertain about any of the prerequisites.

<details>
  <summary>Kyma Environment</summary>

This guide assumes you already have a Global Account, a subaccount on SAP BTP platform and have [Kubernetes CLI](https://kubernetes.io/docs/tasks/tools/#kubectl) installed on your local machine.
If not, please refer to these guides on getting a [Global Account](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/d61c2819034b48e68145c45c36acba6e.html?locale=en-US) and creating a [subaccount](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/05280a123d3044ae97457a25b3013918.html?locale=en-US)

In your subaccount in SAP BTP cockpit, create a [Kyma Environment instance](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/09dd313bf6644250a14f8f38c3d644c0.html?locale=en-US).
Make sure that you select an appropriate [plan](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/befe01d5d8864e59bf847fa5a5f3d669.html?locale=en-US#azure) and also assign the necessary [roles](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/148ae38b7d6f4e61bbb696bbfb3996b2.html?locale=en-US) to users.

:::Note
Creating a Kyma environment instance can take up to 30 minutes.
:::

</details>

<details>
  <summary>Docker</summary>

This guide assumes you have [Docker](https://www.docker.com/) installed on your local machine.

Furthermore, you need a **Docker repository** where you can store images.
The repository needs to be publicly accessible in order for the cluster to access and download the Docker image we are going to create.

In case you don't have such a repository yet we recommend either:

- [Docker Hub](https://hub.docker.com/)
- [Artifactory DMZ](https://common.repositories.cloud.sap/ui/) (for SAP internal developers)

Access to images in a repository may be limited to authenticated and/or authorized users, depending on your configuration.

Make sure you are logged in to your repository on your local machine by running:

```bash
docker login (your-repo) --username=(your-username)
```

And check your configuration which is usually located under `(your-home-directory)/.docker/config.json`.

:::tip
In case AuthN/AuthZ is required to download images make sure you have a secret configured in your cluster-> To do how to this in Kyma?
```bash
kubectl create secret docker-registry (name-of-the-secret) --docker-username=(username) --docker-password=(API-token) --docker-server=(your-repo)
```

:::

</details>

<details>
  <summary>Application using the SAP Cloud SDK</summary>

If you don't have an application already you can comfortably [create one from our archetypes](../getting-started).

</details>

### Containerize the Application

To run on Kyma the application needs to be shipped in a container.
For this guide we will be using Docker.

Create a `Dockerfile` in the project root directory:

```dockerfile {2}
FROM openjdk:8u312-jdk-slim
ARG JAR_FILE=application/target/*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

If needed, update the `JAR_FILE` to point to your JAR file.

:::tip
You can find more information on how to containerize Spring Boot applications in [this guide](https://spring.io/guides/gs/spring-boot-docker/) (in particular, check the _Containerize It_ section).
:::

Compile and push the image by running:

```bash
docker build -t <your-repo>/<your-image-name> .
docker push <your-repo>/<your-image-name>
```

:::tip
In case you are facing authorization issues when pushing to your repository refer to the dedicated section under [Prerequisites](#prerequisites).
:::

### Create a Kyma Deployment

1. Create a new YAML file describing the Kyma deployment:
<!-- vale off -->
   ```yml title="deployment.yml" {18,32}
 apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: [Name of the deployment]
 spec:
   replicas: 1
   selector:
     matchLabels:
       app: [Name of the app]
   template:
     metadata:
       labels:
         app: [Name of the app]
     spec:
       containers:
       # Configure the docker image you just pushed to your repository here
         - image: [Name of the image]
           name: [Name of the app]
           imagePullPolicy: Always
           resources:
             requests:
               memory: '1.5Gi'
               cpu: '500m'
             limits:
               memory: '2Gi'
               cpu: '1000m'
           # To do - do these lines enable seeing debug logs- clarify
           #env:
           #  - name: LOGGING_LEVEL_COM_SAP_CLOUD_SDK
           #    value: DEBUG
           #  - name: LOGGING_LEVEL_ORG_APACHE_HTTP_WIRE
           #    value: DEBUG
           # Volume mounts needed for injecting SAP BTP service credentials
           volumeMounts:
       imagePullSecrets:
         - name: docker-repository-token
       volumes:
 ---
 apiVersion: v1
 kind: Service
 metadata:
   labels:
     app: [Name of the app]
   name: [Name of the app]
   namespace: [Name of your namespace]
 spec:
   type: NodePort
   ports:
     - port: 8080
       targetPort: 8080
       protocol: TCP
   selector:
     app: [Name of the app]
   ```
<!-- vale on -->
2. Install the configuration via `kubectl apply -f path/to/deployment/file/deployment.yml`.

**Todo - Test the following steps:**
3. Monitor the status of the deployment by running: `kubectl get deployment my-app-deployment`.

Eventually, you should see an output similar to:

```bash
kubectl get deployment my-app-deployment

NAME                READY   UP-TO-DATE   AVAILABLE   AGE
my-app-deployment   1/1     1            1           15s
```

:::tip
In case something went wrong use `kubectl describe` together with `deployment` or `pod` to get more information about the status of your application.
:::

### Access Your Application inside the cluster

To access your application from inside the cluster find the name of the application pod by listing out all available pods:

```bash
kubectl -n [namespace] get pods

```
Now use the name of the application pod and open a shell in this pod using:

```bash
kubectl -n [namespace] exec --stdin --tty [pod-name] -- /bin/sh

```
Install [`curl`](https://curl.se/) on your pod depending on the Linux distribution of your pod and access the application by accessing an endpoint using `curl`.
In case you started with an SAP Cloud SDK Archetype, you can test the `hello` endpoint:

```

curl localhost:8080/hello

```

### Bind SAP BTP Services to the Application

The SAP Business Technology Platform offers various services that can be used by applications.
To access services from a Kyma environment instances have to be created and bound to the application.

For this guide we'll assume we want to use two services:

1. Destination Service
2. XSUAA Service

#### Bind the Destination Service

1. Create a new YAML file :

```yml title="destination-service.yaml"
---
apiVersion: servicecatalog.k8s.io/v1beta1
kind: ServiceInstance
metadata:
  name: [Name of your new destination service instance]
spec:
  clusterServiceClassExternalName: destination
  clusterServicePlanExternalName: [Your desired plan]
---
apiVersion: servicecatalog.k8s.io/v1beta1
kind: ServiceBinding
metadata:
   name: [Name of your service binding]
spec:
   instanceRef:
     name: [Name of your destination service instance]
   secretName: my-dest-secret
```

2. Install the configuration via `kubectl -n [namespace] apply -f destination-service.yml`.

3. Monitor the status via `kubectl describe ServiceInstance {Name of your new destination service instance}`.
   Eventually this should automatically create a Kubernetes secret named `my-dest-secret`.
   This secret will contain the actual service binding information.

4. Mount the `my-dest-secret` secret into the file system of the application as follows:

   1. Find the empty list of `volumes` at the end of your `deployment.yml`.
      Add a new volume, referencing the secret:

      ```yml title="volumes:"
      - name: [Name of your destination service instance]
        secret:
          secretName: my-dest-secret
      ```

   2. Mount this volume into the file system of your application.
      Add it to the empty list of `volumeMounts` in the `container` section of your `deployment.yml`:

      ```yml title="volumeMounts:"
      - name: [Name of the service instance]
        mountPath: "/path/to/store/binding"
        readOnly: true
      ```

5. Update the configuration via `kubectl apply -f deployment.yml`.

#### Bind the XSUAA Service

1. Create a new YAML file :

```yml title="xsuaa-service.yaml"
---
apiVersion: servicecatalog.k8s.io/v1beta1
kind: ServiceInstance
metadata:
  name: [Name of your new xsuaa service instance]
spec:
  clusterServiceClassExternalName: xsuaa
  clusterServicePlanExternalName: [Your desired plan]
---
apiVersion: servicecatalog.k8s.io/v1beta1
kind: ServiceBinding
metadata:
   name: [Name of your service binding]
spec:
   instanceRef:
     name: [Name of your xsuaa service instance]
   secretName: my-xsuaa-secret
```

2. Repeat the same steps 2-5 from the previous section but make use of `my-xsuaa-secret` for the steps.

##### Known XSUAA Service incompatibility

We have observed that the property `plan` is missing in the XSUAA secret created in the previous section.
This property, however, is required by the SAP Cloud SDK and it's absence causes runtime errors in the application while trying to read this service binding.

To fix this issue you need to edit the secret so that it contains the `plan` property.
The easiest way, when you are already using the CLI, is by using the `kubectl edit` command:

```bash
kubectl edit secrets my-xsuaa-secret
```
In there you can now add a `plan` property with one of the following base64 encoded values:

| plan          | base64 encoded value |
| ------------- | -------------------- |
| `application` | `YXBwbGljYXRpb24K`   |
| `broker`      | `YnJva2VyCg==`       |
| `space`       | `c3BhY2UK`           |
| `apiaccess`   | `YXBpYWNjZXNzCg==`   |

The resulting service binding can now be consumed with the SAP Cloud SDK.

### Access Your Application outside the cluster

We will configure and deploy an [Approuter](https://help.sap.com/products/BTP/65de2977205c403bbc107264b8eccf4b/01c5f9ba7d6847aaaf069d153b981b51.html?locale=en-US) so that only authenticated users can access our application.
